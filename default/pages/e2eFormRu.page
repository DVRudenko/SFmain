<apex:page language="ru" controller="E2EFormRuCtrl" action="{!init}" id="e2eFormRu" docType="html-5.0" sideBar="false" showHeader="false" standardStylesheets="false" cache="false">

    <head>
        <title>ППР – оформление договора онлайн на топливные карты.</title>
        <!-- Analitic code -->
        <script>
            dataLayer = [{
                'pageType': 'E2E',
                'userAuth': '',
                'userId': '',
                'cityId': '',
                'cityName': ''
            }];
            (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
            })(window,document,'script','dataLayer','GTM-MSQGKSR'); 
         </script>
         
        <apex:includeScript value="{!$Resource.jQuery}"/>
        <apex:includeScript value="{!$Resource.jqueryInputMask}"/>
        <apex:includeScript value="{!URLFOR($Resource.e2eRu_bootstrap_min_js)}"/>
        <apex:includeScript value="{!URLFOR($Resource.e2eLiveAgentDeployment)}"/>
        <apex:includeScript value="{!$Resource.e2eRu_libs_min}"/>
        <apex:includeScript value="{!$Resource.jquerymCustomScrollbar}"/>
        <apex:includeScript value="{!$Resource.e2eRu_scripts}"/>
        <apex:includeScript value="{!$Resource.e2eRu_codewords}"/>
        <apex:stylesheet value="{!URLFOR($Resource.e2eRu_bootstrap_min_css)}"/>
        <apex:stylesheet value="{! $Resource.e2eRu_libs_min_css }"/>
        <apex:stylesheet value="{! $Resource.e2eRu_styles }"/>
        <apex:stylesheet value="{! $Resource.e2eRu_style_main_compact }"/>

        <link rel="icon shortcut" href="{!URLFOR($Resource.e2eRu_images,'PPRFavicon.png')}" type="image/x-icon"/>
        <style>

                html,
                body {
                   height:100%;
                }
                #container {
                   min-height:100%;
                   position:relative;
                }
                #footer {
                   position:absolute;
                   box-sizing: border-box;
                   background-color: #ececec;
                   position: absolute;
                   color: #636363;
                   line-height: 24px;
                   bottom: 0;
                   left: 0;
                   right: 0;
                }

                @font-face {
                    font-family: Proxima Nova light;
                    src: url({!URLFOR($Resource.e2eRu_online_fonts,'proximanova-light-webfont.eot')});
                    src: url({!URLFOR($Resource.e2eRu_online_fonts,'proximanova-light-webfont.eot?#iefix')}) format('embedded-opentype'),
                        url({!URLFOR($Resource.e2eRu_online_fonts,'proximanova-light-webfont.woff2')}) format('woff2'),
                        url({!URLFOR($Resource.e2eRu_online_fonts,'proximanova-light-webfont.woff')}) format('woff'),
                        url({!URLFOR($Resource.e2eRu_online_fonts,'proximanova-light-webfont.ttf')}) format('truetype'),
                        url({!URLFOR($Resource.e2eRu_online_fonts,'proximanova-light-webfont.svg#icon')}) format('svg');
                    font-weight: 300;
                    font-style: normal
                }

                @font-face {
                    font-family: Proxima Nova reg;
                    src: url({!URLFOR($Resource.e2eRu_online_fonts,'proximanova-reg-webfont.eot')});
                    src: url({!URLFOR($Resource.e2eRu_online_fonts,'proximanova-reg-webfont.eot?#iefix')}) format('embedded-opentype'),
                        url({!URLFOR($Resource.e2eRu_online_fonts,'proximanova-reg-webfont.woff2')}) format('woff2'),
                        url({!URLFOR($Resource.e2eRu_online_fonts,'proximanova-reg-webfont.woff')}) format('woff'),
                        url({!URLFOR($Resource.e2eRu_online_fonts,'proximanova-reg-webfont.ttf')}) format('truetype'),
                        url({!URLFOR($Resource.e2eRu_online_fonts,'proximanova-reg-webfont.svg#icon')}) format('svg');
                    font-weight: 400;
                    font-style: normal
                }

                .stetps__blocks-footer .st__bl-btn.next:after {
                    right: 30px;
                    background: url({!URLFOR($Resource.e2eRu_images, 'arrow.png')});
                }

                .js-tooltips-text:after {
                    position: absolute;
                    bottom: -12px;
                    left: 60px;
                    width: 21px;
                    height: 13px;
                    content: '';
                    background: url({!URLFOR($Resource.e2eRu_images,'bottom_tooltip.png')});
                }

                .block__inputs-radio .block__inputs-radio--fake {
                    position: absolute;
                    right: 19px;
                    width: 23px;
                    height: 23px;
                    background-image: url({!URLFOR($Resource.e2eRu_images,'fake__checkbox.png')});
                    -webkit-box-flex: 0;
                    -webkit-flex: 0 0 auto;
                    -ms-flex: 0 0 auto;
                    flex: 0 0 auto;
                }

                .block__inputs .block_checkbox .fake__checkbox {
                    width: 23px;
                    height: 23px;
                    margin-right: 6px;
                    background-image: url({!URLFOR($Resource.e2eRu_images, 'fake__checkbox.png')});
                    -webkit-box-flex: 0;
                    -webkit-flex: 0 0 auto;
                    -ms-flex: 0 0 auto;
                    flex: 0 0 auto;
                }

                .block__list li:after {
                    position: absolute;
                    top: 50%;
                    left: 0;
                    width: 12px;
                    height: 8px;
                    content: '';
                    -webkit-transform: translateY(-50%);
                    -ms-transform: translateY(-50%);
                    transform: translateY(-50%);
                    background: url({!URLFOR($Resource.e2eRu_images,'mark.jpg')}) no-repeat left center;
                }

                .block__list_card li:after {
                    position: absolute;
                    top: 50%;
                    left: 0;
                    width: 12px;
                    height: 8px;
                    content: '';
                    -webkit-transform: translateY(-50%);
                    -ms-transform: translateY(-50%);
                    transform: translateY(-50%);
                    background: url({!URLFOR($Resource.e2eRu_images,'mark.png')}) no-repeat left center;
                }
                .block__list_card li {
                    position: relative;
                    margin-bottom: 5px;
                    padding-left: 26px;
                }
                .block__list_card {
                    padding-left: 5px;
                    font-size: 12px;
                }

                .block__inputs-podr.print:before {
                    left: -27px;
                    width: 18px;
                    height: 16px;
                    background: url({!URLFOR($Resource.e2eRu_images,'print.jpg')}) no-repeat left center;
                }

                .block__inputs.goods .input__obl:after {
                    position: absolute;
                    top: 50%;
                    right: 20px;
                    width: 12px;
                    height: 9px;
                    content: '';
                    -webkit-transform: translateY(-50%);
                    -ms-transform: translateY(-50%);
                    transform: translateY(-50%);
                    background: url({!URLFOR($Resource.e2eRu_images,'mark.png')});
                }

                .block__inputs.erase .input__obl:after {
                    position: absolute;
                    cursor: pointer;
                    top: 50%;
                    right: 20px;
                    width: 10px;
                    height: 10px;
                    content: '';
                    -webkit-transform: translateY(-50%);
                    -ms-transform: translateY(-50%);
                    transform: translateY(-50%);
                    background: url({!URLFOR($Resource.e2eRu_images,'cross.png')});
                }

                .block__inputs-podr.views:before {
                    left: -28px;
                    width: 20px;
                    height: 21px;
                    background: url({!URLFOR($Resource.e2eRu_images,'pdf.jpg')}) no-repeat left center;
               }

                .ordering__steps-item {
                    font-size: 14px;
                    font-weight: 300;
                    line-height: 45px;
                    display: inline-block;
                    float: left;
                    width: 100%;
                    max-width: 326px;
                    height: 48px;
                    cursor: default;
                    text-align: center;
                    letter-spacing: 0;
                    background-image: url({!URLFOR($Resource.e2eRu_images,'step_new1.png')});
                    background-repeat: no-repeat;
                    background-position: left center;
                }

                .ordering__steps-finish {
                    max-width: 326px;
                    margin: 0 0 0 -19px;
                    background-image: url({!URLFOR($Resource.e2eRu_images,'step-finish_new1.png')});
                }

                .ordering__steps-finish.active {
                    background-image: url({!URLFOR($Resource.e2eRu_images,'step-finish-active_new1.png')});
                }

                .ordering__steps-one {
                    background-image: url({!URLFOR($Resource.e2eRu_images,'step-start_new1.png')});
                }

                .block__inputs .input__obl .close {
                    position: absolute;
                    z-index: 5;
                    top: 50%;
                    right: 20px;
                    width: 10px;
                    height: 10px;
                    cursor: pointer;
                    -webkit-transform: translateY(-50%);
                    -ms-transform: translateY(-50%);
                    transform: translateY(-50%);
                    background:url({!URLFOR($Resource.e2eRu_images,'cross.png')});
                    opacity: .6;
                }

                .stetps__blocks-footer .st__bl-btn.prev:after {
                    left: 30px;
                    background: url({!URLFOR($Resource.e2eRu_images,'prev.png')});
                }

                .goods_data:before {
                    position: absolute;
                    top: 2px;
                    left: -2px;
                    width: 30px;
                    height: 30px;
                    content: '';
                    background: url({!URLFOR($Resource.e2eRu_images,'check.png')});
                 }

                .chat-header .close {
                    width: 15px;
                    height: 15px;
                    color: #3F536E;
                    opacity: 1;
                    margin: 7px 5px 5px 0;
                    background: url({!URLFOR($Resource.e2eRu_images, 'close2.png')}) no-repeat;
                }

                .ordering__steps-step.active {
                    background-image:  url({!URLFOR($Resource.e2eRu_images,'step-active_new1.png')});
                }


                @media (max-width: 767.99px) {
                    .tooltip-image {
                        background:url({!URLFOR($Resource.e2eRu_images, 'caret-down.png')}) no-repeat;
                        width: 16px;
                        height: 16px;
                        right: -25px;
                    }

                    .tooltip-image-textarea {
                        right: 5px;
                    }

                    .tooltip-image-checkbox {
                        right: -5px;
                    }
                }

                @media (min-width: 768px) {
                    .tooltip-image {
                        background:url({!URLFOR($Resource.e2eRu_images, 'tooltip-green.png')}) no-repeat;
                        width: 16px;
                        height: 16px;
                    }
                }

                .arrow-up {
                    background:url({!URLFOR($Resource.e2eRu_images, 'caret-up.png')}) no-repeat;
                }

                .arrow-down {
                    background:url({!URLFOR($Resource.e2eRu_images, 'caret-down.png')}) no-repeat;
                }


                .clearable{
                  background: #fff url({!URLFOR($Resource.e2eRu_images, 'cross.png')}) no-repeat right -20px center;
                  border: 1px solid #999;
                  padding: 3px 25px 3px 4px;     /* Use the same right padding (18) in jQ! */
                  border-radius: 3px;
                  transition: background 0.4s;
                }
                .clearable.x  { background-position: right 22px center; } /* (jQ) Show icon */
                .clearable.onX{ cursor: pointer; }              /* (jQ) hover cursor style */
                .clearable::-ms-clear {display: none; width:0; height:0;} /* Remove IE default X */

                @keyframes spinner {
                  to {transform: rotate(360deg);}
                }

                .spinner:before {
                  content: '';
                  box-sizing: border-box;
                  position: absolute;
                  width: 20px;
                  height: 20px;
                  margin-top: -10px;
                  border-radius: 50%;
                  border: 2px solid #ccc;
                  border-top-color: #333;
                  animation: spinner .6s linear infinite;
                }

                .disabled-div {
                    pointer-events: none;
                    opacity: 0.4;
                    background-color: #ececec;
                }

                .lds-spinner {
                  color: official;
                  display: inline-block;
                  width: 30px;
                  height: 30px;
                  margin-bottom: 12px;
                }
                .lds-spinner div {
                  transform-origin: 25px 25px;
                  animation: lds-spinner 1.2s linear infinite;
                }
                .lds-spinner div:after {
                  content: " ";
                  display: block;
                  position: absolute;
                  top: 14px;
                  left: 24px;
                  width: 2px;
                  height: 7px;
                  border-radius: 3%;
                  background: #000;
                }
                .lds-spinner div:nth-child(1) {
                  transform: rotate(0deg);
                  animation-delay: -1.1s;
                }
                .lds-spinner div:nth-child(2) {
                  transform: rotate(30deg);
                  animation-delay: -1s;
                }
                .lds-spinner div:nth-child(3) {
                  transform: rotate(60deg);
                  animation-delay: -0.9s;
                }
                .lds-spinner div:nth-child(4) {
                  transform: rotate(90deg);
                  animation-delay: -0.8s;
                }
                .lds-spinner div:nth-child(5) {
                  transform: rotate(120deg);
                  animation-delay: -0.7s;
                }
                .lds-spinner div:nth-child(6) {
                  transform: rotate(150deg);
                  animation-delay: -0.6s;
                }
                .lds-spinner div:nth-child(7) {
                  transform: rotate(180deg);
                  animation-delay: -0.5s;
                }
                .lds-spinner div:nth-child(8) {
                  transform: rotate(210deg);
                  animation-delay: -0.4s;
                }
                .lds-spinner div:nth-child(9) {
                  transform: rotate(240deg);
                  animation-delay: -0.3s;
                }
                .lds-spinner div:nth-child(10) {
                  transform: rotate(270deg);
                  animation-delay: -0.2s;
                }
                .lds-spinner div:nth-child(11) {
                  transform: rotate(300deg);
                  animation-delay: -0.1s;
                }
                .lds-spinner div:nth-child(12) {
                  transform: rotate(330deg);
                  animation-delay: 0s;
                }
                @keyframes lds-spinner {
                  0% {
                    opacity: 1;
                  }
                  100% {
                    opacity: 0;
                  }
                }

                .ppr-header #desktop-free-service {display: inline-block;}
                .ppr-header #mobile-free-service {display: none;}

                .ppr-header #desktop-free-service.none {display: none;}
                .ppr-header #mobile-free-service.none {display: none;}

                .form-e2e {
                    padding-bottom:210px;
                }

                @media (max-width: 767.99px){
                    .ppr-header #desktop-free-service {display: none;}
                    .ppr-header #mobile-free-service {display: block; padding: 0 20px; margin: 0 auto;}

                    .ppr-header {
                        font-size: 30px;
                        font-weight: 400;
                        line-height: 30px;
                        font-family: Proxima Nova reg, Arial, Helvetica, sans-serif;
                    }
                    .form-e2e {
                        padding-bottom: 220px;
                    }

                    #footer {
                        height: 210px;
                        margin-top: -380px;
                        padding-top: 32px;
                        text-align: center;
                    }
                }

                @media only screen and (min-width: 1025px) {
                    #footer {
                        height: 200px;
                        margin-top: -439px;
                        padding-top: 63px;
                    }
                }

                .glyphicon-gift-icon {
                    width: 13px;
                    height: 14px;
                    background:url({!URLFOR($Resource.e2eRu_images, 'glyphicon-gift-color.png')}) no-repeat;
                    display: inline-block;
                }

                .fixed-steps {
                    position: fixed;
                    z-index:1000;
                    background-color: #ececec;
                    top:0;
                }

                .hideHeader {
                    display: none;
                }

                .step-order-fix {
                    position: fixed;
                    z-index:1000;
                    top: 40%;
                    left: 80%;
                    display: none;
                }

                .wrapper > div{

                    display: grid;
                    align-content: center;
                    grid-template-columns: 1fr 1fr;
                    grid-gap: 1em;

                }
                .box1 {
                    grid-column-start: 1;
                    grid-column-end: 1;
                    grid-row-start: 3;
                    grid-row-end: 4;
                    display: grid;
                    grid-template-columns: repeat(3, 1fr);
                    text-align: center;
                    position: relative;
                    display: -webkit-box;
                    max-inline-size: 120px;

                }
                .nested {
                    border: none;
                    background-color: #06cecc;
                    padding: 12px 20px;
                    font-size: 20px;
                    cursor: pointer;
                    display: inline-block;
                    border-radius: 50%;
                    color: white;
                    width: 48px;
                    height: 48px;
                }
                .tabs {
                     position: relative;
                }
                .tabs3 {
                    display: -webkit-box;
                }
                .farme {
                    padding: 10px;
                }
                .input_fild {
                     margin-left: 10px;
                     margin-right: 10px;
                }

                .exitblock {
                    display:none;
                    position:fixed;
                    left:0;
                    top:0;
                    width:100%;
                    height:100%;
                    z-index:100000;
                }
                .exitblock .fon {
                    background: #F6FCFF;
                    opacity:.8;
                    position:fixed;
                    width:100%;
                    height:100%;
                }
                .exitblock .modaltext {
                    box-sizing: border-box;
                    padding:20px 40px;
                    border: 2px solid #AEAEAE;
                    background: #F6FCFF;
                    position:fixed;
                    top:80px;
                    left:50%;
                    margin-left:-30%;
                    width:60%;
                    box-shadow: 0 4px 10px 2px rgba(0,0,0,0.5);
                    font-size: large;
                    font-weight: 1000;
                }
                .closeblock {
                    cursor:pointer;
                    position: fixed;
                    line-height:60px;
                    font-size:82px;
                    transform: rotate(45deg);
                    text-align:center;
                    top:20px;
                    right:30px;
                    color: #337AB7;
                }
                .closeblock:hover {
                    color: #000;
                }
                .btn {
                    word-break:break-all;
                    padding: 5px;
                    background: #51cfcc;
                    text-decoration: none;
                    border-radius: 4px;
                    cursor: pointer;
                }

                
            </style>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <script>
                var isSole = false;
                var allowPayOverdraft = false;

                //Function is used to get splash status bar when server side call is going on
                function startSplash() {
                    document.getElementById('splashDiv').style.display='table-cell';
                    jQuery('.lightbox').fadeIn(50);
                    $('html, body').css({
                        overflow: 'hidden',
                        height: 'auto'
                    });
                    $("body").css("padding-right", "17px");
                }

                //Function will make the splash status to be stopped.
                function endSplash() {
                    document.getElementById('splashDiv').style.display='none';
                    jQuery('.lightbox').fadeOut(50);
                    $('html, body').css({
                        overflow: '',
                        height: ''
                    });
                    $("body").css("padding-right", "");
                    /*footerPosition();*/
                }

                function startPayOverdraftSplash() {
                    allowPayOverdraft = false;
                    $('#payOverdraftLabel').css('margin-bottom', -2);
                    $('#payOverdraft').hide();
                    $('.pay-overdraft-spinner').show();
                }

                function stopPayOverdraftSplash() {
                    if (allowPayOverdraft == true) {
                        $('#payOverdraft').show();
                    } else {
                        $('#payOverdraft').hide();
                    }
                    $('.pay-overdraft-spinner').hide();
                    $('#payOverdraftLabel').css('margin-bottom', 15);
                }
            </script>
        <apex:stylesheet value="{!URLFOR($Resource.E2ESpinner, 'spinner.css')}"/>

    </head>
    <body>
        <noscript>
           <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MSQGKSR"
            height="0" width="0" style="display:none;visibility:hidden">
            </iframe>
        </noscript>
    <div id="container">
        <apex:form id="form" html-autocomplete="off" styleClass="form-e2e">
            <apex:outputPanel id="startStepBlock">
                <!--<apex:actionFunction name="setStartStep" reRender="startStepBlock" onComplete="setActiveStep('{!activeStep}');footerPosition();" />-->
                <apex:actionFunction name="setStartStep" reRender="startStepBlock" onComplete="setActiveStep('{!activeStep}');footerPosition();" />
            </apex:outputPanel>

            <apex:actionFunction name="setDeviceType" action="{! setDeviceType }" onComplete="console.log('device ok');">
                <apex:param id="param0" name="deviceType" value="" />
            </apex:actionFunction>

           
            <!-- UTM metrics -->
            <apex:inputHidden id="utmMedium" value="{!formParams.utmMedium}"/>
            <apex:inputHidden id="utmSource" value="{!formParams.utmSource}"/>
            <apex:inputHidden id="utmCampaign" value="{!formParams.utmCampaign}"/>
            <apex:inputHidden id="utmTerm" value="{!formParams.utmTerm}"/>
            <apex:inputHidden id="utmContent" value="{!formParams.utmContent}"/>
            <apex:inputHidden id="websitePageForm" value="{!formParams.websitePageForm}"/>
            <apex:inputHidden id="splitTesting" value="{!formParams.splitTesting}"/>
            <apex:inputHidden id="encodedURL" value="{!formParams.encodedURL}"/>

            <script type="text/javascript">
                function queryParam(name, url) {
                    if (!url) url = window.location.href;
                    url = url.replace('UTM_SOURCE', 'utm_source').replace('UTM_CAMPAIGN', 'utm_campaign').replace('UTM_MEDIUM', 'utm_medium').replace('UTM_CONTENT', 'utm_content').replace('UTM_TERM', 'utm_term').replace('UTM_IP', 'utm_ip').replace('UTM_REGION', 'utm_region');
                    name = name.replace(/[\[\]]/g, "\\$&");
                    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                        results = regex.exec(url);
                    if (!results) return null;
                    if (!results[2]) return '';
                    return decodeURIComponent(results[2].replace(/\+/g, " "));
                }

                function commonUrlParam(param){
                    var url_string = window.location.href;
                    var url = new URL(url_string);
                    var split = url.searchParams.get(param);
                    if(split == null){
                         return '';
                    } else {
                        return split;
                    }
                }

                function setCookie(utm, utmvar, exdays) {
                    var d = new Date();
                    d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
                    var expires = "expires="+ d.toUTCString();
                    var val = (utmvar == null || utmvar == undefined) ? " " : utmvar;
                    //document.cookie = utm + "=" + val + ";" + expires + ";path=/";
                    if(!{!enableCaching} && (utm == "apex__url" || utm == "website_page_form")){
                        document.cookie = utm + "=;" + expires + ";path=/";
                    } else {
                        document.cookie = utm + "=" + val + ";" + expires + ";path=/";
                    }
                }

                function getCookie(utm) {
                    var name = utm + "=";
                    var ca = document.cookie.split(';');
                    for(var i = 0; i < ca.length; i++) {
                        var c = ca[i];
                        while (c.charAt(0) == ' ') {
                            c = c.substring(1);
                        }
                        if (c.indexOf(name) == 0) {
                            return c.substring(name.length, c.length);
                        }
                    }
                    return "";
                }

                function getCookieURL(website_page) {
                    var name = website_page + "=";
                    var ca = document.cookie.split(';');
                    for(var i = 0; i < ca.length; i++) {
                        var c = ca[i];
                        while (c.charAt(0) == ' ') {
                            c = c.substring(1);
                        }
                        if (c.indexOf(name) == 0) {
                            return c.substring(name.length, c.length);
                        }
                    }
                    return "";
                }

                function getQueryStringVariables(){
                    return {
                        source: queryParam('utm_source'),
                        campaign: queryParam('utm_campaign'),
                        medium: queryParam('utm_medium'),
                        content: queryParam('utm_content'),
                        term: queryParam('utm_term'),
                        website: window.location.href,
                        split: commonUrlParam('split')
                    }
                }

                function isQueryStringSet(){
                    var queryStringVariables = getQueryStringVariables();
                    if (queryStringVariables.source ||
                        queryStringVariables.campaign ||
                        queryStringVariables.medium ||
                        queryStringVariables.content ||
                        queryStringVariables.term) {
                        return true;
                    }
                    return false;
                }

                function fetchCookieData() {
                    return {
                        source: getCookie("utm_source"),
                        campaign: getCookie("utm_campaign"),
                        medium: getCookie("utm_medium"),
                        content: getCookie("utm_content"),
                        term: getCookie('utm_term'),
                        website: getCookieURL('website_page_form'),
                        split: getCookie('split')
                    };
                };

                function updateCookie() {
                    var queryStringVariables = getQueryStringVariables();
                    if (isQueryStringSet()) {
                        setCookie("utm_source", queryStringVariables.source, 7);
                        setCookie("utm_campaign", queryStringVariables.campaign, 7);
                        setCookie("utm_medium", queryStringVariables.medium, 7);
                        setCookie("utm_content", queryStringVariables.content, 7);
                        setCookie("utm_term", queryStringVariables.term, 7);
                        setCookie("website_page_form", queryStringVariables.website, 7);
                    }
                    if(queryStringVariables.split != ''){
                        /*console.log('split ' + commonUrlParam('split'));*/
                        setCookie("split", queryStringVariables.split, 7);
                    }
                }
                updateCookie();
                var cookieData = fetchCookieData();
                /*console.log(cookieData);*/
                $j('[id$=utmMedium]').val(cookieData.medium); /* Campaign_Medium */
                $j('[id$=utmSource]').val(cookieData.source); /* Campaign_Source */
                $j('[id$=utmCampaign]').val(cookieData.campaign); /* Campaign_CampaignName */
                $j('[id$=utmTerm]').val(cookieData.term); /* Campaign_Term */
                $j('[id$=utmContent]').val(cookieData.content); /* Campaign_Content */
                $j('[id$=websitePageForm]').val(cookieData.website); /* Website Page Form */

                if(cookieData.split != ''){
                    $j('[id$=splitTesting]').val(cookieData.split); /* Website Page Form */
                }


            </script>
            <!-- /UTM metrics -->

            <apex:outputPanel layout="block" styleClass="ppr-header">
                <apex:outputPanel layout="block" styleClass="default" style="padding: 30px 0px 30px 0px;">
                    <div>
                        <a target="_blank" style="text-decoration: none;" rel="noopener noreferrer" href="https://www.petrolplus.ru/">
                            <img src="{!URLFOR($Resource.e2eRu_images, 'ppr-logo.png')}" alt="ppr-logo.png" height="73px"/>
                        </a>
                        <apex:outputPanel rendered="{!showBanner}">
                            <div id="desktop-free-service" class="{!if(formParams.product == 'PetrolPlus_Gaz' && formParams.sourcePP != 'metro','','none')}">
                                <a target="_blank" style="text-decoration: none;" rel="noopener noreferrer" href="http://www.petrolplus.ru/docs.php?f=GES_gsa">
                                    <img src="{!URLFOR($Resource.e2eRu_images, 'promo-gasprom.png')}" alt="free-service-full.png" height="125px"/>
                                </a>
                            </div>
                            <div id="desktop-free-service" class="{!if(formParams.product == 'PetrolPlus_Rover' && formParams.sourcePP != 'metro','','none')}">
                                <a target="_blank" style="text-decoration: none;" rel="noopener noreferrer" href="http://www.petrolplus.ru/docs.php?f=rn-bn-tnk">
                                    <img src="{!URLFOR($Resource.e2eRu_images, 'promo-gasprom.png')}" alt="free-service-full.png" height="125px"/>
                                </a>
                            </div>
                        </apex:outputPanel>
                    </div>
                    <apex:outputPanel rendered="{!showBanner}">
                        <div class="step-order-fix">
                            <div id="desktop-free-service" class="{!if(formParams.product == 'PetrolPlus_Gaz' && formParams.sourcePP != 'metro','','none')}">
                                <a target="_blank" style="text-decoration: none;" rel="noopener noreferrer" href="http://www.petrolplus.ru/docs.php?f=GES_gsa">
                                    <img src="{!URLFOR($Resource.e2eRu_images, 'promo-gasprom.png')}" alt="free-service-full.png" height="125px"/>
                                </a>
                            </div>
                            <div id="desktop-free-service" class="{!if(formParams.product == 'PetrolPlus_Rover' && formParams.sourcePP != 'metro','','none')}">
                                <a target="_blank" style="text-decoration: none;" rel="noopener noreferrer" href="http://www.petrolplus.ru/docs.php?f=rn-bn-tnk">
                                    <img src="{!URLFOR($Resource.e2eRu_images, 'promo-gasprom.png')}" alt="free-service-full.png" height="125px"/>
                                </a>
                            </div>
                        </div>
                    </apex:outputPanel>
                </apex:outputPanel>
                <apex:outputPanel layout="block" styleClass="ppr-header-line" />
                <div id="mobile-free-service" class="{!if(formParams.product == 'PetrolPlus_Rover' && formParams.sourcePP != 'metro','','none')}">
                    <a target="_blank" style="text-decoration: none;" rel="noopener noreferrer" href="http://www.petrolplus.ru/docs.php?f=rn-bn-tnk">
                        <img style="max-width:100%;" src="{!URLFOR($Resource.e2eRu_images, 'promo-gasprom-mob.png')}" alt="free-service-mob.png"/>
                    </a>
                </div>
                <div id="mobile-free-service" class="{!if(formParams.product == 'PetrolPlus_Gaz' && formParams.sourcePP != 'metro','','none')}">
                    <a target="_blank" style="text-decoration: none;" rel="noopener noreferrer" href="http://www.petrolplus.ru/docs.php?f=GES_gsa">
                        <img style="max-width:100%;" src="{!URLFOR($Resource.e2eRu_images, 'promo-gasprom-mob.png')}" alt="free-service-mob.png"/>
                    </a>
                </div>
                <apex:outputPanel id="cards_header" layout="block">
                    <apex:outputPanel layout="block" style="text-align:center;" styleClass="default {! IF(activeStep == 'Congratulations' || activeStep == 'CompanyInformation' || activeStep == 'Order' || activeStep == 'SummaryOrder' || activeStep == 'LegalDetails' || activeStep == 'PaymentDetails' || errorStep != null, 'header-lock','')}">
                        <apex:outputText escape="false"  value="{! pagesContentMap['SHARED RESOURCES'].fields['HEADERS'].elementItemsMap['CARDS REQUEST'].value }"/>
                    </apex:outputPanel>
                    <apex:outputPanel layout="block" style="text-align:center;" styleClass="default {! IF(activeStep == 'ContactDetails' || activeStep == 'Congratulations', 'header-lock','')}">
                        <apex:outputText escape="false" value="{! pagesContentMap['SHARED RESOURCES'].fields['HEADERS'].elementItemsMap['CARDS ORDER'].value }"/>
                    </apex:outputPanel>
                    <apex:outputPanel layout="block" style="text-align:center;" styleClass="default {! IF(activeStep == 'ContactDetails' || activeStep == 'CompanyInformation' || activeStep == 'Order' || activeStep == 'SummaryOrder' || activeStep == 'LegalDetails' || activeStep == 'PaymentDetails' || errorStep != null, 'header-lock','')}">
                        <apex:outputText escape="false" value="{! pagesContentMap['SHARED RESOURCES'].fields['HEADERS'].elementItemsMap['CARDS CONTRACT'].value }"/>
                    </apex:outputPanel>
                </apex:outputPanel>
            </apex:outputPanel>
            <div class="ordering">
                <div class="default">
                    <apex:outputPanel layout="block" id="ordering__steps" styleClass="{! IF(activeStep == 'ContactDetails' || activeStep == 'Congratulations' , 'header-lock','')}">
                        <apex:outputPanel layout="block" styleClass="ordering__steps" rendered="{! IF(activeStep == 'ErrorMessage', FALSE, TRUE)}">
                            <apex:outputPanel layout="block" styleClass="ordering__steps-item ordering__steps-one {! IF(activeStep == 'CompanyInformation' || activeStep == 'Order' || activeStep == 'SummaryOrder' || activeStep == 'LegalDetails' || activeStep == 'PaymentDetails' || activeStep == 'Congratulations' , 'active','')}">
                                <apex:outputPanel >{! pagesContentMap['SHARED RESOURCES'].fields['HEADERS'].elementItemsMap['COMPANY INFORMATION HEADER'].value }</apex:outputPanel>
                            </apex:outputPanel>
                            <apex:outputPanel layout="block" styleClass="ordering__steps-item ordering__steps-step {! IF(activeStep == 'Order' || activeStep == 'SummaryOrder' || activeStep == 'LegalDetails' || activeStep == 'PaymentDetails' || activeStep == 'Congratulations' , 'active','')}">
                                <apex:outputPanel >{! pagesContentMap['SHARED RESOURCES'].fields['HEADERS'].elementItemsMap['ORDER INFORMATION HEADER'].value }</apex:outputPanel>
                            </apex:outputPanel>
                            <apex:outputPanel layout="block" styleClass="ordering__steps-item ordering__steps-finish {! IF(activeStep == 'LegalDetails' || activeStep == 'PaymentDetails' || activeStep == 'Congratulations' , 'active','')}">
                                <apex:outputPanel >{! pagesContentMap['SHARED RESOURCES'].fields['HEADERS'].elementItemsMap['LEGAL DETAILS HEADER'].value }</apex:outputPanel>
                            </apex:outputPanel>
                        </apex:outputPanel>
                    </apex:outputPanel>

                    <apex:actionStatus id="splashStatus" onstart="startSplash();" onstop="endSplash(); "/>
                    <div class="splashStatus" id="splashDiv" >
                        <div class="circle"><img src="{!URLFOR($Resource.e2eRu_images, 'spin.gif')}" alt="spin"/></div>
                    </div>

                    <div class="lightbox"></div>

                    <apex:outputPanel layout="block" id="formBlock" styleClass="form-block">
                        <!-- STEP 1 CONTACT DETAILS -->
                        <apex:outputPanel id="step1" layout="block" styleClass="step-contact-details stetps__blocks {! IF(activeStep == 'Congratulations', 'steps-lock','') }">
                            <apex:outputPanel layout="block"
                                              styleClass="headers__stepts
                                                          {! IF(activeStep == 'ContactDetails' || activeStep == 'CompanyInformation' || activeStep == 'Order' || activeStep == 'SummaryOrder' || activeStep == 'LegalDetails' || activeStep == 'PaymentDetails' || activeStep == 'Congratulations' , 'header-is-active','')}
                                                          {! IF(formParams.sourceIfSelfSourced == 'Web-To-Lead' && formParams.source == 'PetrolPlus', 'header-in-two-lines', '') } ">
                                <apex:outputPanel rendered="{! IF(formParams.sourceIfSelfSourced == '' || formParams.source != 'PetrolPlus', true, false) }">
                                    {!pagesContentMap['SHARED RESOURCES'].fields['HEADERS'].elementItemsMap['CONTACT DETAILS HEADER'].value}
                                </apex:outputPanel>
                                <apex:outputPanel rendered="{! IF(formParams.sourceIfSelfSourced == 'Web-To-Lead' && formParams.source == 'PetrolPlus', true, false) }">
                                    {!pagesContentMap['SHARED RESOURCES'].fields['HEADERS'].elementItemsMap['CONTACT DETAILS HEADER (Web-To-Lead Line 1 Item 1)'].value}
                                    <apex:outputPanel style="font-weight: bold; display: inline">
                                        <!--{!pagesContentMap['SHARED RESOURCES'].fields['HEADERS'].elementItemsMap['CONTACT DETAILS HEADER (Web-To-Lead Line 1 Item 2)'].value}-->
                                        <br/>
                                        {!pagesContentMap['SHARED RESOURCES'].fields['HEADERS'].elementItemsMap['CONTACT DETAILS HEADER (Web-To-Lead Line 2)'].value}
                                    </apex:outputPanel>
                                </apex:outputPanel>
                            </apex:outputPanel>

                            <apex:outputPanel rendered="{!IF(activeStep == 'ContactDetails' || activeStep == 'CompanyInformation' || activeStep == 'Order' || activeStep == 'SummaryOrder' || activeStep == 'LegalDetails' || activeStep == 'PaymentDetails' || activeStep == 'Congratulations', TRUE, FALSE)}" layout="block"  styleClass="stetps__blocks_container">
                                <apex:outputPanel layout="block" styleClass="stetps__blocks-content">
                                    <c:E2EComponentInputTooltip pageMap="{! pagesContentMap['CONTACT DETAILS'].fields }"
                                                                field="MOBILE NUMBER"
                                                                firstClass="block__inputs validations"
                                                                secondClass="input__obl"
                                                                inputClass="phoneNumber clearable"
                                                                errorClass="error--text"
                                                                maxLength="16"
                                                                inputType="tel"
                                                                position="bottom"/>
                                    <c:E2EComponentInputTooltip pageMap="{! pagesContentMap['CONTACT DETAILS'].fields }"
                                                                field="EMAIL ADDRESS"
                                                                firstClass="block__inputs validations"
                                                                secondClass="input__obl"
                                                                inputClass="emailAddress clearable"
                                                                errorClass="error--text"
                                                                maxLength="80"
                                                                inputType="email"
                                                                position="top"/>
                                    <c:E2EComponentCheckboxWithCommandLink pageMap="{! pagesContentMap['CONTACT DETAILS'].fields }"
                                                                           field="PERSONAL INFORMATION"
                                                                           blockClass="block__inputs zero-margin"
                                                                           validationClass="block_checkbox validations"
                                                                           bottomDivClass="df"
                                                                           className="personal_data_agreement"
                                                                           errorClass="error--text"
                                                                           firstTextPart="{! pagesContentMap['CONTACT DETAILS'].fields['PERSONAL INFORMATION'].elementItemsMap['LABEL'].value }"
                                                                           actionFunctionValue="{! pagesContentMap['CONTACT DETAILS'].fields['PERSONAL INFORMATION'].elementItemsMap['LINK LABEL'].value }"
                                                                           actionFunctionValueSecond="{! IF(formParams.sourcePP == 'sberbank', pagesContentMap['CONTACT DETAILS'].fields['PERSONAL INFORMATION'].elementItemsMap['LINK LABEL SECOND'].value, null) }"
                                                                           onClick="showPersonalInfoPolicy(); return false;"
                                                                           actionFunctionClass="label-link-margin"
                                                                           target="myModal"
                                                                           targetSecond="{!IF(formParams.sourcePP == 'sberbank', 'marketingPromotionModal', null)}"/>
                                    <c:E2EComponentCheckboxWithCommandLink pageMap="{! pagesContentMap['CONTACT DETAILS'].fields }"
                                                                           field="MARKETING DISPATCH"
                                                                           blockClass="block__inputs zero-margin"
                                                                           validationClass="block_checkbox validations "
                                                                           bottomDivClass="df"
                                                                           className="block__inputs validations agreement-to-receive-information"
                                                                           errorClass="error--text"
                                                                           firstTextPart="{! pagesContentMap['CONTACT DETAILS'].fields['MARKETING DISPATCH'].elementItemsMap['LABEL'].value }"
                                                                           actionFunctionValue="{! pagesContentMap['CONTACT DETAILS'].fields['MARKETING DISPATCH'].elementItemsMap['LINK LABEL'].value }"
                                                                           onClick="showSalesPromotion(); return false;"
                                                                           actionFunctionClass="label-link-margin"
                                                                           target="myModal"/>
                                    <apex:inputHidden id="userDetector" value="{!formParams.companyFullNameDadata}" />
                                    <c:E2EComponentModal pageMap="{! pagesContentMap['CONTACT DETAILS'].fields }"
                                                         field="PERSONAL INFORMATION POLICY"
                                                         target="myModal"
                                                         buttonClass="modal-button preview-inside-button"
                                                         modalClass="print-document-body"/>
                                    <c:E2EComponentModal pageMap="{! pagesContentMap['CONTACT DETAILS'].fields }"
                                                         field="MARKETING PROMOTION CONTENT"
                                                         rendered="{!formParams.sourcePP == 'sberbank'}"
                                                         target="marketingPromotionModal"
                                                         buttonClass="modal-button preview-inside-button"
                                                         modalClass="print-document-body"/>

                                </apex:outputPanel>
                                <apex:outputPanel layout="block" styleClass="stetps__blocks-footer">
                                    <c:E2EComponentButton value="{! pagesContentMap['SHARED RESOURCES'].fields['BUTTONS'].elementItemsMap['NEXT STEP'].value }"
                                                          onclick="clickNextFromFisrtStep(); return false;"
                                                          firstClass="component-button"
                                                          className="st__bl-btn next go-next-step"
                                                          buttonClass="st__bl-btn next-button"/>
                                    <apex:actionFunction id="goToCompanyDetails"
                                                         name="goToCompanyDetails"
                                                         action="{!goToCompanyDetails}"
                                                         oncomplete="onCompleteGoToSecondStep('{!activeStep}');"
                                                         status="splashStatus"
                                                         reRender="step2, step3, legalAndPaymentDetails, ordering__steps, goToCompanyDetails, errorProcessing, cards_header, encodedURL" />
                                    <apex:actionFunction id="updateContactPhone"
                                                         name="updateContactPhone"
                                                         action="{! updateContactPhone }"
                                                         status="splashStatus"
                                                         oncomplete="checkPersonalDataAgreement();"/>
                                </apex:outputPanel>
                            </apex:outputPanel>
                        </apex:outputPanel>

                        <!-- STEP 2 COMPANY INFORMATION -->
                        <apex:outputPanel id="step2" layout="block" styleClass="step-company-information stetps__blocks {! IF(activeStep == 'ContactDetails' || activeStep == 'Congratulations', 'steps-lock','')}">
                            <apex:outputPanel layout="block" styleClass="headers__stepts {! IF(activeStep == 'CompanyInformation' || activeStep == 'Order' || activeStep == 'SummaryOrder' || activeStep == 'LegalDetails' || activeStep == 'PaymentDetails' || activeStep == 'Congratulations' , 'header-is-active header-in-two-lines','')}">
                                <!--                                <span>{! pagesContentMap['SHARED RESOURCES'].fields['HEADERS'].elementItemsMap['COMPANY INFORMATION HEADER'].value }</span>-->
                                {!pagesContentMap['SHARED RESOURCES'].fields['HEADERS'].elementItemsMap['CONTACT DETAILS HEADER (Web-To-Lead Line 1 Item 1)'].value}
                                <!--{!pagesContentMap['SHARED RESOURCES'].fields['HEADERS'].elementItemsMap['CONTACT DETAILS HEADER (Web-To-Lead Line 1 Item 2)'].value}-->
                                <br/>
                                <apex:outputPanel style="font-weight: bold; display: inline"  rendered="{! IF(formParams.product == 'PetrolPlus_Rover', true, false) }">
                                    {!pagesContentMap['SHARED RESOURCES'].fields['HEADERS'].elementItemsMap['CONTACT DETAILS HEADER (Web-To-Lead Line 2 Rover)'].value}
                                </apex:outputPanel>
                                <apex:outputPanel style="font-weight: bold; display: inline"  rendered="{! IF(formParams.product == 'PetrolPlus_Rover', false, true) }">
                                    {!pagesContentMap['SHARED RESOURCES'].fields['HEADERS'].elementItemsMap['CONTACT DETAILS HEADER (Web-To-Lead Line 2)'].value}
                                </apex:outputPanel>
                            </apex:outputPanel>

                            <apex:outputPanel rendered="{!IF(activeStep == 'CompanyInformation' || activeStep == 'Order' || activeStep == 'SummaryOrder' || activeStep == 'LegalDetails' || activeStep == 'PaymentDetails' || activeStep == 'Congratulations', TRUE, FALSE)}" layout="block" styleClass="stetps__blocks_container">
                                <apex:outputPanel id="companyDetailsInner" layout="block" styleClass="stetps__blocks-content">
                                    <c:E2EComponentInputTooltip pageMap="{! pagesContentMap['COMPANY INFORMATION'].fields }"
                                                                field="ACCOUNT NAME"
                                                                firstClass="block__inputs search validations"
                                                                secondClass="input__obl"
                                                                inputClass="searchCompany uppercase-class clearable"
                                                                errorClass="error--text"
                                                                maxLength="50"
                                                                inputType="text"
                                                                position="bottom"/>
                                    <c:E2EComponentInputTooltip pageMap="{! pagesContentMap['COMPANY INFORMATION'].fields }"
                                                                field="INN"
                                                                firstClass="block__inputs validations"
                                                                secondClass="input__obl"
                                                                inputClass="companyInn clearable"
                                                                errorClass="error--text"
                                                                maxLength="12"
                                                                inputType="text"
                                                                position="top"/>
                                    <div style="{! IF(enableManualEntry, 'display: block', 'display: none') }">
                                        <c:E2EComponentCheckbox pageMap="{! pagesContentMap['COMPANY INFORMATION'].fields }"
                                                                field="IS MANUAL ENTRY"
                                                                blockClass="block__inputs zero-margin"
                                                                validationClass="block_checkbox validations"
                                                                bottomDivClass="df"
                                                                className="companyNotExist"
                                                                firstTextPart="{! pagesContentMap['COMPANY INFORMATION'].fields['IS MANUAL ENTRY'].elementItemsMap['LABEL'].value }"/>
                                    </div>
                                </apex:outputPanel>
                                <apex:outputPanel layout="block" styleClass="stetps__blocks-footer">
                                    <c:E2EComponentButton value="{! pagesContentMap['SHARED RESOURCES'].fields['BUTTONS'].elementItemsMap['PREVIOUS STEP'].value }"
                                                          onclick="clickBackFromSecondStep(); return false;"
                                                          firstClass="component-button"
                                                          className="st__bl-btn prev"
                                                          buttonClass="st__bl-btn prev-button"/>
                                    <apex:actionFunction id="backToContactDetails"
                                                         name="backToContactDetails"
                                                         action="{!backToContactDetails}"
                                                         onComplete="setActiveStep('{!activeStep}');"
                                                         reRender="ordering__steps, backToContactDetails" />
                                    <c:E2EComponentButton value="{! pagesContentMap['SHARED RESOURCES'].fields['BUTTONS'].elementItemsMap['NEXT STEP'].value }"
                                                          onclick="clickNextFromSecondStep(); return false;"
                                                          firstClass="component-button"
                                                          className="st__bl-btn next go-next-step"
                                                          buttonClass="st__bl-btn order-button"/>
                                    <apex:actionFunction id="goToOrderInformation"
                                                         name="goToOrderInformation"
                                                         action="{!goToOrderInformation}"
                                                         onComplete="onCompleteGoToThirdStep('{!activeStep}', '{! opportunityId }', '{!formDataId}', '{!formParams.deduplicationStatus}');"
                                                         status="splashStatus"
                                                         reRender="step3, ordering__steps, goToOrderInformation, errorProcessing, cards_header, encodedURL" />
                                    <apex:actionFunction id="isManualEntryFunction"
                                                         name="isManualEntryFunction"
                                                         onComplete="setEvents_companyDetails(); setActiveStep('{!activeStep}'); switchDaDaOn();"
                                                         reRender="companyDetailsInner"
                                                         status="splashStatus"/>
                                    <apex:actionFunction id="isManualEntryFunctionDaDataOff"
                                                         name="isManualEntryFunctionDaDataOff"
                                                         onComplete="setEvents_companyDetails(); setActiveStep('{!activeStep}'); companyDetailsManualEntryEvents();"
                                                         reRender="companyDetailsInner"
                                                         status="splashStatus"/>
                                </apex:outputPanel>
                                <apex:inputHidden id="companyInformationFullName" value="{!formParams.companyFullNameDadata}" />
                                <apex:inputHidden id="soleProprietorLegalAddress" value="{!formParams.legalAddressSpark}" />
                                <apex:inputHidden id="isSoleProprietor" value="{!formParams.isSoleProprietor}"/>
                                <apex:inputHidden id="companyInfoSpark" value="{!companyInfoSpark}"/>
                                <apex:inputHidden id="soleInfoSpark" value="{!soleInfoSpark}"/>
                                <apex:inputHidden id="blackListDecision" value="{!formParams.verifiedDecisionCode}"/>
                                <apex:inputHidden id="opportunityLostReason" value="{!formParams.opportunityLostReason}"/>
                                <apex:inputHidden id="sendToInbound" value="{!formParams.sendToInbound}"/>
                                <apex:inputHidden id="checkedInBlackList" value="{!formParams.checkedInBlackList}"/>
                                <apex:inputHidden id="scoringPassed" value="{!formParams.scoringPassed}"/>
                                <apex:inputHidden id="scoringDecision" value="{!formParams.scoringDecision}"/>
                                <apex:inputHidden id="scoringDecisionCode" value="{!formParams.scoringDecisionCode}"/>
                                <apex:inputHidden id="executiveId" value="{!formParams.executiveId}"/>
                            </apex:outputPanel>
                        </apex:outputPanel>

                        <!-- STEP 3 Order Information -->
                        <apex:outputPanel id="step3" layout="block" styleClass="step-order-information stetps__blocks {! IF(activeStep == 'ContactDetails' || activeStep == 'Congratulations', 'steps-lock','')}">
                            <apex:outputPanel layout="block" styleClass="headers__stepts {! IF(activeStep == 'Order' || activeStep == 'SummaryOrder' || activeStep == 'LegalDetails' || activeStep == 'PaymentDetails' || activeStep == 'Congratulations' , 'header-is-active','')}">
                                <span>{! pagesContentMap['SHARED RESOURCES'].fields['HEADERS'].elementItemsMap['ORDER INFORMATION HEADER'].value }</span>
                            </apex:outputPanel>
                            <apex:outputPanel id="step3-1" layout="block" rendered="{!IF( activeStep == 'Order' || activeStep == 'SummaryOrder' || activeStep == 'LegalDetails' || activeStep == 'PaymentDetails' || activeStep == 'Congratulations', TRUE, FALSE)}" styleClass="stetps__blocks_container step-3-1">
                                <apex:outputPanel layout="block" styleClass="stetps__blocks-content">

                                    <div class="wrapper">
                                        <apex:outputPanel layout="block" styleClass="{!IF(productNotChange == true, '', 'promocode-lock')}">
                                            <!--                                        <c:E2EComponentOutputOrderDetail pageMap="{! pagesContentMap['ORDER'].fields }"-->
                                            <!--                                                                         field="PRODUCTS"/>-->

                                            <div class="grid-card">
                                                <c:E2EComponentImage url="{!if(formParams.product == 'PetrolPlus_Rover' || formParams.product == 'Partner_Rover', URLFOR($Resource.e2eRu_images,'card.jpg'), URLFOR($Resource.e2eRu_images,'card_gas.png'))}"/>
                                            </div>
                                            <!--                                        add cad discription-->
                                            <div class="grid-about">
                                                <c:E2EComponentList list="{! pagesContentMap['ORDER'].fields["GIFT LIST"].elementItemsMap['CARD_DISCRIPTION'].value }"
                                                                    split=","
                                                                    ulClass="block__list_card"
                                                                    labelValue="{! pagesContentMap['ORDER'].fields["GIFT LIST"].elementItemsMap['CARD_LABEL'].value }"
                                                                    labelClass="block__tables--title"/>
                                                <div class="tabs">
                                                    <div class="content  scroll__error">
                                                        <a href="javascript:void(0)" onclick="showHide('block_discriptionDitails')">Показать еще >></a>
                                                        <div id="block_discriptionDitails" style="display: none;">
                                                            <c:E2EcomponentDetails list="{! pagesContentMap['ORDER'].fields["GIFT LIST"].elementItemsMap['CARD_DISCRIPTION_ADD'].value }"
                                                                                   split=","
                                                                                   ulClass="block__list_card"/>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="grid-amount box1">
                                                <div><apex:commandButton id="buttonM" value="-" styleClass="nested" onClick="changeNumberOfSelectedCards('js-count-cart scroll__error',1,100,-1);" reRender="none"/></div>
                                                <div class="input_fild">
                                                    <c:E2EComponentInputCard pageMap="{! pagesContentMap['ORDER'].fields }"
                                                                             field="AMOUNT CARD"
                                                                             firstClass="block__inputs validations"
                                                                             secondClass="input__obl"
                                                                             maxLength="3"
                                                                             inputType="tel"
                                                                             errorClass="error--text"
                                                                             inputClass="js-count-cart scroll__error"
                                                                             position="top"/>
                                                </div>
                                                <div><apex:commandButton id="buttonP" value="+" styleClass="nested" onClick="changeNumberOfSelectedCards('js-count-cart scroll__error',1,100,1);" reRender="none"/></div>
                                            </div>
                                            <!--                                        <apex:outputPanel layout="block" styleClass="{!IF(productNotChange == false, '', 'promocode-lock')}">-->
                                            <!--                                            <c:E2EComponentInputList pageMap="{! pagesContentMap['ORDER'].fields }"-->
                                            <!--                                                                     field="PRODUCTS"-->
                                            <!--                                                                     offer="{! offer }"-->
                                            <!--                                                                     firstClass="block__inputs validations goods"-->
                                            <!--                                                                     secondClass="input__obl"-->
                                            <!--                                                                     inputClass="js-product"-->
                                            <!--                                                                     maxLength="50"-->
                                            <!--                                                                     inputType="text" />-->
                                            <!--                                        </apex:outputPanel>-->

                                            <!--                                        <c:E2EComponentInputTooltip pageMap="{! pagesContentMap['ORDER'].fields }"-->
                                            <!--                                                                    field="AMOUNT CARD"-->
                                            <!--                                                                    firstClass="block__inputs validations"-->
                                            <!--                                                                    secondClass="input__obl"-->
                                            <!--                                                                    maxLength="3"-->
                                            <!--                                                                    inputType="tel"-->
                                            <!--                                                                    errorClass="error&#45;&#45;text"-->
                                            <!--                                                                    inputClass="js-count-cart scroll__error"-->
                                            <!--                                                                    position="top"/>-->
                                            <div class="tabs1">
                                                <c:E2EComponentLabel pageMap="{! pagesContentMap['ORDER'].fields }"
                                                                     field="AMOUNT CARD" />
                                            </div>
                                            <div class="tabs2">
                                            </div>
                                            <div class="tabs3">
                                                <div class="frame input_fild"><c:E2EComponentImage url="{!URLFOR($Resource.e2eRu_images,'Button_card.jpg')}"/></div>
                                                <div class="farme"><c:E2EComponentLabelCard pageMap="{! pagesContentMap['ORDER'].fields }"
                                                                                            field="AMOUNT CARD" /></div>
                                            </div>
                                        </apex:outputPanel>
                                    </div>

                                    <apex:inputHidden id="lastTimeSelectedTariff" value="{! lastTimeSelectedTariff }" />
                                    <apex:inputHidden id="selectedTariff" value="{!selectedTariff}"/>
                                    <apex:outputPanel layout="block" styleClass="stetps__blocks_hide">

                                        <apex:outputPanel layout="block" styleClass="block__inputs">
                                            <apex:outputPanel styleClass="block__inputs--title mob__hide">
                                                {! pagesContentMap['ORDER'].fields['SELECT TARIFF'].elementItemsMap['LABEL'].value}
                                            </apex:outputPanel>
                                            <div id="TariffErrorDesktop" align="center" class="mob__hide error--text">{! pagesContentMap['ORDER'].fields['SELECT TARIFF'].elementItemsMap['ERROR'].value}</div>

                                            <apex:outputPanel layout="block" id="tariffsPropertiesMobile" styleClass="stetps__blocks_hide_mobile">
                                                <apex:outputPanel layout="block" styleClass="block__inputs validations">
                                                    <c:E2EComponentLabel pageMap="{! pagesContentMap['ORDER'].fields }"
                                                                         field="SELECT TARIFF" />
                                                    <apex:outputPanel layout="block" styleClass="block__inputs-flex">
                                                        <div id="TariffErrorMobile" class="error--text">{! pagesContentMap['ORDER'].fields['SELECT TARIFF'].elementItemsMap['ERROR'].value}</div>
                                                        <c:E2EComponentTariffPills pageMap="{! msl_suffix }"/>
                                                    </apex:outputPanel>
                                                </apex:outputPanel>
                                            </apex:outputPanel>

                                            <apex:outputPanel layout="block" id="tariffsPropertiesDesktop" styleClass="tariffs-block">
                                                <apex:outputPanel layout="block" id="isTariffsSeparation" style="display: none;">
                                                    {! formParams.numberOfTariffsDependency }
                                                </apex:outputPanel>
                                                <apex:outputPanel layout="block" id="currentNumberOfCards" style="display: none;">
                                                    {! pagesContentMap['ORDER'].fields['AMOUNT CARD'].elementItemsMap['DEFAULT VALUE'].value }
                                                </apex:outputPanel>
                                                <c:E2EComponentCarouselTariffs pageMap="{! msl_suffix }" tariffs="{! tariffs }" firstTariff="{!selectedTariff}" />
                                                <c:E2EComponentModal pageMap="{! pagesContentMap['ORDER'].fields }"
                                                                     field="{! formParams.product }"
                                                                     target="DiscountsModal"
                                                                     buttonClass="modal-button preview-inside-button"
                                                                     modalClass="print-discounts-body"/>
                                            </apex:outputPanel>

                                            <apex:outputPanel layout="block" id="promocodeComplete" styleClass="promocode-section {! IF(formParams.promoCode == '', 'promocode-lock', '') }">
                                                <div class="block__inputs validations">
                                                    <div class="block__inputs validations">
                                                        <label style="color: #964B00;">{! pagesContentMap['ORDER'].fields["PROMOCODE DESCRIPTION"].elementItemsMap['PROMOCODE LABEL'].value}</label>
                                                        <apex:outputPanel layout="block" styleClass="fake__inputs-text">
                                                            <apex:outputText escape="false" value="{! pagesContentMap['ORDER'].fields["PROMOCODE DESCRIPTION"].elementItemsMap['PROMOCODE DESCRIPTION TITLE'].value}"/>
                                                        </apex:outputPanel>
                                                    </div>
                                                </div>
                                            </apex:outputPanel>

                                            <apex:outputPanel layout="block" styleClass="block__dops" style="border-bottom:0;">
                                                <!--                                                sf-1515 hide spinner-->
                                                <!--                                                <div class="pay-overdraft-block df">-->
                                                <!--                                                    <label id="payOverdraftLabel" style="margin-bottom: 15px;"> {! pagesContentMap['ORDER'].fields['ADDITIONAL SERVICES'].elementItemsMap['LABEL'].value } </label>-->
                                                <!--                                                    <div class="pay-overdraft-spinner lds-spinner" style="display: none;"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>-->
                                                <!--                                                </div>-->
                                                <c:E2EComponentCheckboxService pageMap="{! pagesContentMap['ORDER'].fields }"
                                                                               field="PERSONAL MANAGER"
                                                                               firstClass="block_checkbox validations"
                                                                               tooltipClass="tooltip-checkbox"/>
                                                <c:E2EComponentCheckboxService pageMap="{! pagesContentMap['ORDER'].fields }"
                                                                               field="DOCS DELIVERY"
                                                                               firstClass="block_checkbox validations"
                                                                               tooltipClass="tooltip-checkbox"/>
                                                <!--                                                sf-1515 hide payOverdraft-->
                                                <!--                                                <div id="payOverdraft" style="{! IF(formParams.scoringDecisionCode == '0', 'display:block', 'display:none')}">-->
                                                <!--                                                    <apex:outputPanel layout="block">-->
                                                <!--                                                        <c:E2EComponentCheckboxService pageMap="{! pagesContentMap['ORDER'].fields }"-->
                                                <!--                                                                                       field="PAY OVERDRAFT"-->
                                                <!--                                                                                       firstClass="block_checkbox validations"-->
                                                <!--                                                                                       tooltipClass="tooltip-checkbox"/>-->
                                                <!--                                                    </apex:outputPanel>-->
                                                <!--                                                </div>-->
                                                <c:E2EComponentOutput pageMap="{! pagesContentMap['ORDER'].fields }"
                                                                      field="NO OFFER"
                                                                      className="block__dops-title no-offer" />

                                                <apex:outputPanel layout="block" styleClass="mobile__tooltips"></apex:outputPanel>
                                            </apex:outputPanel>
                                            <apex:outputPanel layout="block" styleClass="stetps__blocks-footer order-step-footer">
                                                <c:E2EComponentButton value="{! pagesContentMap['SHARED RESOURCES'].fields['BUTTONS'].elementItemsMap['PREVIOUS STEP'].value }"
                                                                      onclick="clickBackFromThirdStep(); return false;"
                                                                      firstClass="component-button"
                                                                      className="st__bl-btn prev"
                                                                      buttonClass="st__bl-btn prev-button"/>
                                                <apex:actionFunction id="backToCompanyInformation"
                                                                     name="backToCompanyInformation"
                                                                     action="{!backToCompanyInformation}"
                                                                     onComplete="setActiveStep('{!activeStep}');"
                                                                     reRender="ordering__steps, backToCompanyInformation" />
                                                <c:E2EComponentButton value="{! pagesContentMap['SHARED RESOURCES'].fields['BUTTONS'].elementItemsMap['NEXT STEP'].value }"
                                                                      onclick="clickNextFromThirdStep(); return false;"
                                                                      firstClass="component-button"
                                                                      className="st__bl-btn next js-goods-order"
                                                                      buttonClass="st__bl-btn order-button"/>
                                                <apex:actionFunction id="goToSummaryOrder"
                                                                     name="goToSummaryOrder"
                                                                     action="{!goToSummaryOrder}"
                                                                     onComplete="onCompleteGoToThirdSummaryStep('{!activeStep}');"
                                                                     status="splashStatus"
                                                                     reRender="step-3-2, ordering__steps, goToSummaryOrder, errorProcessing, cards_header, encodedURL"/>
                                                <apex:actionFunction name="setTariff" action="{! setTariff }" onComplete="return false;">
                                                    <apex:param id="param1" name="tariffName" value="" />
                                                    <apex:param id="param2" name="tariffID" value="" />
                                                </apex:actionFunction>
                                                <apex:actionFunction name="setProduct"
                                                                     action="{! setProduct }"
                                                                     reRender="isTariffsSeparation, AzsLocator"
                                                                     onComplete="startTariffsLoad(); ">
                                                    <apex:param id="param3" name="productID" value="" />
                                                </apex:actionFunction>
                                                <apex:actionFunction name="loadTariffs"
                                                                     rerender="tariffsPropertiesDesktop, tariffsPropertiesMobile, promocodeComplete, currentNumberOfCards"
                                                                     status="splashStatus"
                                                                     onComplete="setEvents_loadTariffs(); setEvents_checkPromocode(); getPromocodeResult(); lockPromocode(); setActiveStep('{!activeStep}'); " />
                                                <apex:actionFunction name="checkPromocode"
                                                                     action="{! checkPromocode }"
                                                                     onComplete="setEvents_checkPromocode(); setActiveStep('{!activeStep}'); getPromocodeResult();"
                                                                     status="splashStatus"
                                                                     reRender="promocodeComplete">
                                                    <apex:param id="param4" name="promocodeName" value="" />
                                                </apex:actionFunction>
                                                <apex:actionFunction name="setPromocodeItem" action="{! setPromocodeItem }" onComplete="return false;">
                                                    <apex:param id="param5" name="promocodeItem" value="" />
                                                </apex:actionFunction>
                                                <apex:actionFunction name="setTariffsContent"
                                                                     action="{! getTariffsOnCards }"
                                                                     reRender="isTariffsSeparation, tariffsPropertiesDesktop, tariffsPropertiesMobile, promocodeComplete, currentNumberOfCards, selectedTariff"
                                                                     onComplete="setEvents_loadTariffs(); setEvents_checkPromocode(); getPromocodeResult(); lockPromocode(); setActiveStep('{!activeStep}'); setTimeout(endSplash, 2000);">
                                                    <apex:param id="param6" name="suffix" value="" />
                                                </apex:actionFunction>
                                            </apex:outputPanel>
                                        </apex:outputPanel>

                                    </apex:outputPanel>

                                </apex:outputPanel>
                            </apex:outputPanel>

                            <apex:outputPanel id="step-3-2" styleClass="stetps__blocks_container step-3-2" layout="block">
                                <apex:outputPanel layout="block" rendered="{!IF(activeStep == 'SummaryOrder' || activeStep == 'LegalDetails' || activeStep == 'PaymentDetails' || activeStep == 'Congratulations', TRUE, FALSE)}">
                                    <apex:outputPanel layout="block" styleClass="stetps__blocks-content pb6">
                                        <c:E2EComponentOutputOrderDetail pageMap="{! pagesContentMap['ORDER'].fields }"
                                                                         field="PRODUCTS"/>
                                        <c:E2EComponentOutputOrderDetail pageMap="{! pagesContentMap['ORDER'].fields }"
                                                                         field="PRODUCT TARIFF"/>
                                        <c:E2EComponentOutputOrderDetail pageMap="{! pagesContentMap['ORDER'].fields }"
                                                                         field="AMOUNT CARD"/>
                                        <c:E2EComponentOutputOrderDetail pageMap="{! pagesContentMap['ORDER'].fields }"
                                                                         field="PAYMENT CONDITIONS"/>
                                        <c:E2EComponentOutputOrderDetailProperty pageMap="{! pagesContentMap['ORDER'].fields}"
                                                                                 productID="{! formParams.productSplitTesting }"
                                                                                 source="{! offer }"/>
                                        <apex:outputPanel layout="block" styleClass="block__inputs validations goods dop__services">

                                            <label for="">{! pagesContentMap['ORDER'].fields["ADDITIONAL SERVICES"].elementItemsMap['LABEL'].value }</label>
                                            <c:E2EComponentServices pageMap="{! pagesContentMap['ORDER'].fields }"
                                                                    field="PERSONAL MANAGER"
                                                                    styleTop="200"/>
                                            <c:E2EComponentServices pageMap="{! pagesContentMap['ORDER'].fields }"
                                                                    field="DOCS DELIVERY"
                                                                    styleTop="120"/>
                                            <c:E2EComponentServices pageMap="{! pagesContentMap['ORDER'].fields }"
                                                                    field="PAY OVERDRAFT"
                                                                    styleTop="160"/>

                                        </apex:outputPanel>
                                        <apex:outputPanel layout="block" styleClass="promocode-result">
                                            <div class="block__inputs validations">
                                                <label>{! pagesContentMap['ORDER'].fields["PROMOCODE DESCRIPTION"].elementItemsMap['PROMOCODE LABEL'].value}</label>
                                                <apex:outputPanel layout="block" styleClass="fake__inputs-text">
                                                    <apex:outputText escape="false" value="{! pagesContentMap['ORDER'].fields["PROMOCODE DESCRIPTION"].elementItemsMap['PROMOCODE DESCRIPTION TITLE'].value}"/>
                                                </apex:outputPanel>
                                            </div>
                                        </apex:outputPanel>

                                        <c:E2EComponentModal pageMap="{! pagesContentMap['ORDER'].fields }"
                                                             field="{! formParams.product }"
                                                             target="DiscountsModal"
                                                             buttonClass="modal-button preview-inside-button"
                                                             modalClass="print-discounts-body"/>

                                        <apex:outputPanel id="AzsLocator" layout="block" styleClass="block__inputs validations goods">
                                            <c:E2EComponentList list="{! pagesContentMap['ORDER'].fields["GIFT LIST"].elementItemsMap['LIST'].value }"
                                                                split=","
                                                                ulClass="block__list"
                                                                labelValue="{! pagesContentMap['ORDER'].fields["GIFT LIST"].elementItemsMap['LABEL'].value }"
                                                                labelClass="block__tables--title"/>
                                        </apex:outputPanel>

                                    </apex:outputPanel>
                                    <apex:outputPanel layout="block" styleClass="stetps__blocks-footer">
                                        <c:E2EComponentButton value="{! pagesContentMap['SHARED RESOURCES'].fields['BUTTONS'].elementItemsMap['PREVIOUS STEP'].value }"
                                                              onclick="clickBackFromThirdSummaryStep(); return false;"
                                                              firstClass="component-button"
                                                              className="st__bl-btn prev"
                                                              buttonClass="st__bl-btn prev-button"/>
                                        <apex:actionFunction id="backToOrderInformation"
                                                             name="backToOrderInformation"
                                                             action="{!backToOrderInformation}"
                                                             onComplete=" setActiveStep('{!activeStep}');"
                                                             reRender="ordering__steps, backToOrderInformation" />
                                        <c:E2EComponentButton value="{! pagesContentMap['SHARED RESOURCES'].fields['BUTTONS'].elementItemsMap['NEXT STEP'].value }"
                                                              onclick="clickNextFromThirdSummaryStep(); return false;"
                                                              firstClass="component-button"
                                                              className="st__bl-btn next js-end-order"
                                                              buttonClass="st__bl-btn order-button"/>
                                        <apex:actionFunction id="goToLegalDetails"
                                                             name="goToLegalDetails"
                                                             action="{!goToLegalDetails}"
                                                             onComplete="onCompleteGoToFourthStep('{!activeStep}');"
                                                             status="splashStatus"
                                                             reRender="legalAndPaymentDetails, ordering__steps, goToLegalDetails, errorProcessing, encodedURL" />
                                    </apex:outputPanel>
                                </apex:outputPanel>
                            </apex:outputPanel>

                        </apex:outputPanel>

                        <!-- STEP 4 LEGAL AND PAYMENT DETAILS -->
                        <div id="outerLegalDetailsDiv">
                            <apex:outputPanel layout="block" id="legalAndPaymentDetails" styleClass="step-legal-and-payment-details stetps__blocks {! IF(activeStep == 'ContactDetails' || activeStep == 'Congratulations', 'steps-lock','')}">
                                <apex:outputPanel layout="block" styleClass="headers__stepts {! IF(activeStep == 'LegalDetails' || activeStep == 'PaymentDetails' || activeStep == 'Congratulations' , 'header-is-active','')}">
                                    <span>{! pagesContentMap['SHARED RESOURCES'].fields['HEADERS'].elementItemsMap['LEGAL DETAILS HEADER'].value }</span>
                                </apex:outputPanel>

                                <apex:outputPanel id="legalDetails" layout="block" styleClass="step-legal-details">
                                    <apex:outputPanel rendered="{!IF(activeStep == 'LegalDetails' || activeStep == 'PaymentDetails' || activeStep == 'Congratulations', TRUE, FALSE)}" layout="block" styleClass="stetps__blocks_container ">

                                        <apex:outputPanel layout="block" styleClass="sole-proprietor" rendered="{! formParams.isSoleProprietor }">
                                            <script>
                                                $j(document).ready(function(){
                                                    validateLegalDetailsIfSoleProprietorOnLoad();
                                                });
                                            </script>
                                            <apex:outputPanel layout="block" styleClass="stetps__blocks-content">
                                                <apex:outputPanel layout="block" id="dataFromSparkIP">
                                                    <c:E2EComponentInput pageMap="{! pagesContentMap['LEGAL DETAILS'].fields }"
                                                                         field="OGRNIP"
                                                                         firstClass="block__inputs validations"
                                                                         secondClass="input__obl"
                                                                         inputClass="ogrnip manual-entry clearable"
                                                                         errorClass="error--text"
                                                                         maxLength="15"
                                                                         inputType="tel" />
                                                    <c:E2EComponentInput pageMap="{! pagesContentMap['LEGAL DETAILS'].fields }"
                                                                         field="OKPO"
                                                                         firstClass="block__inputs validations"
                                                                         secondClass="input__obl"
                                                                         inputClass="js-okpo clearable manual-entry"
                                                                         errorClass="error--text"
                                                                         maxLength="10"
                                                                         inputType="tel" />
                                                    <!--apex:outputPanel layout="block" styleClass="spark-values-checkbox {! IF(sparkCompanyNoDataFound == false, '', 'pay-overdraft-lock') }">
                                                        <c:E2EComponentCheckbox pageMap="{! pagesContentMap['LEGAL DETAILS'].fields }"
                                                                                field="REWRITE DEFAULT SPARK VALUES"
                                                                                blockClass="block__inputs zero-margin"
                                                                                validationClass="block_checkbox validations"
                                                                                bottomDivClass="df"
                                                                                className="rewrite-spark-values"
                                                                                firstTextPart="{! pagesContentMap['LEGAL DETAILS'].fields['REWRITE DEFAULT SPARK VALUES'].elementItemsMap['LABEL'].value }"/>
                                                    </apex:outputPanel-->
                                                    <c:E2EComponentInput pageMap="{! pagesContentMap['LEGAL DETAILS'].fields }"
                                                                         field="LEGAL ADDRESS"
                                                                         firstClass="block__inputs validations"
                                                                         secondClass="input__obl"
                                                                         inputClass="legal-address clearable"
                                                                         errorClass="error--text"
                                                                         maxLength="1030"
                                                                         inputType="text" />
                                                </apex:outputPanel>

                                                <c:E2EComponentInput pageMap="{! pagesContentMap['LEGAL DETAILS'].fields }"
                                                                     field="POSTAL ADDRESS"
                                                                     firstClass="block__inputs validations address-validation"
                                                                     secondClass="input__obl"
                                                                     inputClass="document-address clearable"
                                                                     errorClass="error--text"
                                                                     maxLength="1030"
                                                                     inputType="text" />
                                                <c:E2EComponentCheckbox pageMap="{! pagesContentMap['LEGAL DETAILS'].fields }"
                                                                        field="MATCHES LEGAL ADDRESS"
                                                                        blockClass="block__inputs zero-margin"
                                                                        validationClass="block_checkbox validations"
                                                                        bottomDivClass="df"
                                                                        className="address-2"
                                                                        firstTextPart="{! pagesContentMap['LEGAL DETAILS'].fields['MATCHES LEGAL ADDRESS'].elementItemsMap['LABEL'].value }"/>
                                                <c:E2EComponentInputTextArea pageMap="{! pagesContentMap['LEGAL DETAILS'].fields }"
                                                                             field="CARDS DELIVERY INFORMATION"
                                                                             firstClass="block__inputs validations"
                                                                             secondClass="input__obl"
                                                                             inputClass="delivery-info clearable"
                                                                             tooltipClass="tooltip-textarea"
                                                                             errorClass="error--text"
                                                                             position="top"/>
                                                <c:E2EComponentInputTooltip pageMap="{! pagesContentMap['LEGAL DETAILS'].fields }"
                                                                            field="CODE WORD"
                                                                            firstClass="block__inputs validations"
                                                                            secondClass="input__obl"
                                                                            inputClass="codeWord clearable"
                                                                            errorClass="error--text"
                                                                            maxLength="20"
                                                                            inputType="text"
                                                                            position="top"/>
                                                <c:E2EComponentInputTooltip pageMap="{! pagesContentMap['LEGAL DETAILS'].fields }"
                                                                            field="USER ACCOUNT EMAIL"
                                                                            firstClass="block__inputs validations"
                                                                            secondClass="input__obl"
                                                                            inputClass="account-email clearable"
                                                                            errorClass="error--text"
                                                                            maxLength="80"
                                                                            inputType="text"
                                                                            position="top"/>
                                                <c:E2EComponentInputTooltip pageMap="{! pagesContentMap['LEGAL DETAILS'].fields }"
                                                                            field="USER ACCOUNT PHONE"
                                                                            firstClass="block__inputs validations"
                                                                            secondClass="input__obl"
                                                                            inputClass="phoneNumberLk clearable"
                                                                            errorClass="error--text"
                                                                            maxLength="16"
                                                                            inputType="tel"
                                                                            position="top"/>
                                            </apex:outputPanel>
                                            <apex:outputPanel layout="block" styleClass="stetps__blocks-footer">
                                                <c:E2EComponentButton value="{! pagesContentMap['SHARED RESOURCES'].fields['BUTTONS'].elementItemsMap['PREVIOUS STEP'].value }"
                                                                      onclick="clickBackFromFourthStep(); return false;"
                                                                      firstClass="component-button"
                                                                      className="st__bl-btn prev"
                                                                      buttonClass="st__bl-btn prev-button"/>
                                                <apex:actionFunction id="backToSummaryOrder"
                                                                     name="backToSummaryOrder"
                                                                     action="{!backToSummaryOrder}"
                                                                     onComplete="setEvents_summaryOrder(); setActiveStep('{!activeStep}');"
                                                                     reRender="ordering__steps, backToSummaryOrder" />
                                                <c:E2EComponentButton value="{! pagesContentMap['SHARED RESOURCES'].fields['BUTTONS'].elementItemsMap['NEXT STEP'].value }"
                                                                      onclick="clickNextFromFourthStep(); return false;"
                                                                      firstClass="component-button"
                                                                      className="st__bl-btn next go-to-congratulations"
                                                                      buttonClass="st__bl-btn order-button"/>
                                                <apex:actionFunction id="goToPaymentDetails"
                                                                     name="goToPaymentDetails"
                                                                     action="{!goToPaymentDetails}"
                                                                     onComplete="onCompleteGoToFifthStep('{!activeStep}');"
                                                                     status="splashStatus"
                                                                     reRender="paymentDetails, ordering__steps, goToPaymentDetails, errorProcessing, encodedURL" />
                                            </apex:outputPanel>
                                        </apex:outputPanel>

                                        <apex:outputPanel layout="block" styleClass="legal-entity" rendered="{! !formParams.isSoleProprietor }">
                                            <script>
                                                $j(document).ready(function(){
                                                    validateLegalDetailsIfLegalEntityOnLoad();
                                                });
                                            </script>
                                            <apex:outputPanel layout="block" styleClass="stetps__blocks-content">
                                                <apex:outputPanel layout="block" id="dataFromSparkCompany" styleClass="spark-fields">
                                                    <c:E2EComponentInput pageMap="{! pagesContentMap['LEGAL DETAILS'].fields }"
                                                                         field="OGRN"
                                                                         firstClass="block__inputs validations"
                                                                         secondClass="input__obl"
                                                                         inputClass="js-orgn manual-entry clearable"
                                                                         errorClass="error--text"
                                                                         maxLength="13"
                                                                         inputType="tel" />
                                                    <c:E2EComponentInput pageMap="{! pagesContentMap['LEGAL DETAILS'].fields }"
                                                                         field="KPP"
                                                                         firstClass="block__inputs validations"
                                                                         secondClass="input__obl"
                                                                         inputClass="js-kpp manual-entry clearable"
                                                                         errorClass="error--text"
                                                                         maxLength="9"
                                                                         inputType="tel" />
                                                    <c:E2EComponentInput pageMap="{! pagesContentMap['LEGAL DETAILS'].fields }"
                                                                         field="OKPO"
                                                                         firstClass="block__inputs validations"
                                                                         secondClass="input__obl"
                                                                         inputClass="js-okpo manual-entry clearable"
                                                                         errorClass="error--text"
                                                                         maxLength="8"
                                                                         inputType="tel" />
                                                    <c:E2EComponentInput pageMap="{! pagesContentMap['LEGAL DETAILS'].fields }"
                                                                         field="LEGAL ADDRESS"
                                                                         firstClass="block__inputs validations"
                                                                         secondClass="input__obl"
                                                                         inputClass="legal-address manual-entry clearable"
                                                                         errorClass="error--text"
                                                                         maxLength="1030"
                                                                         inputType="text" />
                                                    <!--apex:outputPanel layout="block" styleClass="spark-values-checkbox {! IF(sparkCompanyNoDataFound == false, '', 'pay-overdraft-lock') }">
                                                        <c:E2EComponentCheckbox pageMap="{! pagesContentMap['LEGAL DETAILS'].fields }"
                                                                                field="REWRITE DEFAULT SPARK VALUES"
                                                                                blockClass="block__inputs zero-margin"
                                                                                validationClass="block_checkbox validations"
                                                                                bottomDivClass="df"
                                                                                className="rewrite-spark-values"
                                                                                firstTextPart="{! pagesContentMap['LEGAL DETAILS'].fields['REWRITE DEFAULT SPARK VALUES'].elementItemsMap['LABEL'].value }"/>
                                                    </apex:outputPanel-->
                                                </apex:outputPanel>
                                                <c:E2EComponentInput pageMap="{! pagesContentMap['LEGAL DETAILS'].fields }"
                                                                     field="POSTAL ADDRESS"
                                                                     firstClass="block__inputs validations"
                                                                     secondClass="input__obl"
                                                                     inputClass="document-address clearable"
                                                                     errorClass="error--text"
                                                                     maxLength="1030"
                                                                     inputType="text" />
                                                <c:E2EComponentCheckbox pageMap="{! pagesContentMap['LEGAL DETAILS'].fields }"
                                                                        field="MATCHES LEGAL ADDRESS"
                                                                        blockClass="block__inputs zero-margin"
                                                                        validationClass="block_checkbox validations"
                                                                        bottomDivClass="df"
                                                                        className="address-2"
                                                                        firstTextPart="{! pagesContentMap['LEGAL DETAILS'].fields['MATCHES LEGAL ADDRESS'].elementItemsMap['LABEL'].value }"/>
                                                <c:E2EComponentInputTextArea pageMap="{! pagesContentMap['LEGAL DETAILS'].fields }"
                                                                             field="CARDS DELIVERY INFORMATION"
                                                                             firstClass="block__inputs validations"
                                                                             secondClass="input__obl"
                                                                             inputClass="delivery-info"
                                                                             tooltipClass="tooltip-textarea"
                                                                             errorClass="error--text"
                                                                             position="top"/>
                                                <c:E2EComponentInput pageMap="{! pagesContentMap['LEGAL DETAILS'].fields }"
                                                                     field="EXECUTIVE PERSON"
                                                                     firstClass="block__inputs validations"
                                                                     secondClass="input__obl"
                                                                     inputClass="executivePersonFullName clearable"
                                                                     errorClass="error--text"
                                                                     maxLength="50"
                                                                     inputType="text"/>
                                                <c:E2EComponentInput pageMap="{! pagesContentMap['LEGAL DETAILS'].fields }"
                                                                     field="EXECUTIVE PERSON POSITION"
                                                                     firstClass="block__inputs validations"
                                                                     secondClass="input__obl"
                                                                     inputClass="executivePersonPosition clearable"
                                                                     errorClass="error--text"
                                                                     maxLength="50"
                                                                     inputType="text"/>
                                                <c:E2EComponentInputTooltip pageMap="{! pagesContentMap['LEGAL DETAILS'].fields }"
                                                                            field="CODE WORD"
                                                                            firstClass="block__inputs validations"
                                                                            secondClass="input__obl"
                                                                            inputClass="codeWord clearable"
                                                                            errorClass="error--text"
                                                                            maxLength="20"
                                                                            inputType="text"
                                                                            position="top"/>
                                                <c:E2EComponentInputTooltip pageMap="{! pagesContentMap['LEGAL DETAILS'].fields }"
                                                                            field="USER ACCOUNT EMAIL"
                                                                            firstClass="block__inputs validations"
                                                                            secondClass="input__obl"
                                                                            inputClass="account-email clearable"
                                                                            errorClass="error--text"
                                                                            maxLength="80"
                                                                            inputType="text"
                                                                            position="top"/>
                                                <c:E2EComponentInputTooltip pageMap="{! pagesContentMap['LEGAL DETAILS'].fields }"
                                                                            field="USER ACCOUNT PHONE"
                                                                            firstClass="block__inputs validations"
                                                                            secondClass="input__obl"
                                                                            inputClass="phoneNumberLk clearable"
                                                                            errorClass="error--text"
                                                                            maxLength="16"
                                                                            inputType="tel"
                                                                            position="top"/>
                                            </apex:outputPanel>
                                            <apex:outputPanel layout="block" styleClass="stetps__blocks-footer">
                                                <c:E2EComponentButton value="{! pagesContentMap['SHARED RESOURCES'].fields['BUTTONS'].elementItemsMap['PREVIOUS STEP'].value }"
                                                                      onclick="clickBackFromFifthStep(); return false;"
                                                                      firstClass="component-button"
                                                                      className="st__bl-btn prev"
                                                                      buttonClass="st__bl-btn prev-button"/>
                                                <apex:actionFunction id="backToSummaryOrder2"
                                                                     name="backToSummaryOrder"
                                                                     action="{!backToSummaryOrder}"
                                                                     onComplete="setEvents_summaryOrder(); setActiveStep('{!activeStep}');"
                                                                     reRender="ordering__steps, backToSummaryOrder2" />
                                                <c:E2EComponentButton value="{! pagesContentMap['SHARED RESOURCES'].fields['BUTTONS'].elementItemsMap['NEXT STEP'].value }"
                                                                      onclick="clickNextFromFifthStep(); return false;"
                                                                      firstClass="component-button"
                                                                      className="st__bl-btn next go-to-congratulations"
                                                                      buttonClass="st__bl-btn order-button"/>
                                                <apex:actionFunction id="goToPaymentDetails2"
                                                                     name="goToPaymentDetails"
                                                                     action="{!goToPaymentDetails}"
                                                                     onComplete="onCompleteGoToSixthStep('{!activeStep}');"
                                                                     status="splashStatus"
                                                                     reRender="paymentDetails, ordering__steps, goToPaymentDetails2, errorProcessing, encodedURL" />
                                            </apex:outputPanel>
                                        </apex:outputPanel>
                                        <apex:outputPanel id="address-information-block" >
                                            <apex:inputHidden id="legalAddressInformationCity" value="{! pagesContentMap['LEGAL DETAILS'].fields['LEGAL ADDRESS'].elementItemsMap['CITY'].value }" />
                                            <apex:inputHidden id="legalAddressInformationPostalCode" value="{! pagesContentMap['LEGAL DETAILS'].fields['LEGAL ADDRESS'].elementItemsMap['POSTAL CODE'].value }" />
                                            <apex:inputHidden id="legalAddressInformationState" value="{! pagesContentMap['LEGAL DETAILS'].fields['LEGAL ADDRESS'].elementItemsMap['STATE'].value }" />
                                            <apex:inputHidden id="legalAddressInformationStreet" value="{! pagesContentMap['LEGAL DETAILS'].fields['LEGAL ADDRESS'].elementItemsMap['STREET'].value }" />
                                            <apex:inputHidden id="legalAddressInformationHouse" value="{! pagesContentMap['LEGAL DETAILS'].fields['LEGAL ADDRESS'].elementItemsMap['HOUSE NUMBER'].value }" />
                                            <apex:inputHidden id="legalAddressInformationFlat" value="{! pagesContentMap['LEGAL DETAILS'].fields['LEGAL ADDRESS ADDITIONALLY'].elementItemsMap['DEFAULT VALUE'].value }" />

                                            <apex:inputHidden id="postalAddressInformationCity" value="{! pagesContentMap['LEGAL DETAILS'].fields['POSTAL ADDRESS'].elementItemsMap['CITY'].value }" />
                                            <apex:inputHidden id="postalAddressInformationPostalCode" value="{! pagesContentMap['LEGAL DETAILS'].fields['POSTAL ADDRESS'].elementItemsMap['POSTAL CODE'].value }" />
                                            <apex:inputHidden id="postalAddressInformationState" value="{! pagesContentMap['LEGAL DETAILS'].fields['POSTAL ADDRESS'].elementItemsMap['STATE'].value }" />
                                            <apex:inputHidden id="postalAddressInformationStreet" value="{! pagesContentMap['LEGAL DETAILS'].fields['POSTAL ADDRESS'].elementItemsMap['STREET'].value }" />
                                            <apex:inputHidden id="postalAddressInformationHouse" value="{! pagesContentMap['LEGAL DETAILS'].fields['POSTAL ADDRESS'].elementItemsMap['HOUSE NUMBER'].value }" />
                                            <apex:inputHidden id="postalAddressInformationFlat" value="{! pagesContentMap['LEGAL DETAILS'].fields['POSTAL ADDRESS ADDITIONALLY'].elementItemsMap['DEFAULT VALUE'].value }" />
                                        </apex:outputPanel>
                                        <apex:inputHidden id="isManualEntry" value="{!formParams.isManualEntry}"/>
                                        <apex:actionFunction id="recoverDataSpark"
                                                             name="recoverDataSpark"
                                                             status="splashStatus"
                                                             action="{! returnDataSpark }"
                                                             onComplete="setEvents_sparkFields();"
                                                             reRender="dataFromSparkIP, dataFromSparkCompany, address-information-block"/>
                                    </apex:outputPanel>
                                </apex:outputPanel>

                                <apex:outputPanel id="paymentDetails" layout="block" styleClass="step-payment-details">
                                    <apex:outputPanel rendered="{!IF(activeStep == 'PaymentDetails' || activeStep == 'Congratulations', TRUE, FALSE)}" layout="block" styleClass="stetps__blocks_container">
                                        <script>
                                            $j(document).ready(function(){
                                                validatePaymentDetailsOnLoad();
                                            });
                                        </script>
                                        <apex:actionFunction id="previewContract"
                                                             name="previewContract"
                                                             action="{! activatePreviewContract }"
                                                             onComplete="openPDF('{! previewContractContent }'); return false;"
                                                             status="splashStatus"/>
                                        <script>
                                            function openPDF(data) {
                                                if (data != undefined && data != '') {
                                                    var pageNumber = Math.floor((Math.random() * 100) + 1);
                                                    var win = window.open("about:blank", "_blank",'PopUp' + pageNumber + ',scrollbars=1,menubar=0,resizable=1,width=850,height=500');
                                                    win.document.write('<iframe width="100%" height="100%" src="data:application/pdf;base64,' + data + '" frameborder="0" allowfullscreen></iframe>')
                                                } else {
                                                    alert('Попробуйте сгенерировать отчет позже!');
                                                }
                                            }
                                        </script>
                                        <apex:outputPanel layout="block" styleClass="stetps__blocks-content">
                                            <c:E2EComponentInputTooltip pageMap="{! pagesContentMap['PAYMENT DETAILS'].fields }"
                                                                        field="BANK NAME"
                                                                        firstClass="block__inputs validations"
                                                                        secondClass="input__obl"
                                                                        inputClass="bankName uppercase-class clearable"
                                                                        errorClass="error--text"
                                                                        maxLength="50"
                                                                        inputType="text"
                                                                        position="top"/>
                                            <c:E2EComponentInput pageMap="{! pagesContentMap['PAYMENT DETAILS'].fields }"
                                                                 field="BIC"
                                                                 firstClass="block__inputs validations"
                                                                 secondClass="input__obl"
                                                                 inputClass="js-bik clearable"
                                                                 errorClass="error--text"
                                                                 maxLength="9"
                                                                 inputType="text"/>
                                            <c:E2EComponentInput pageMap="{! pagesContentMap['PAYMENT DETAILS'].fields }"
                                                                 field="CHECKING ACCOUNT"
                                                                 firstClass="block__inputs validations"
                                                                 secondClass="input__obl"
                                                                 inputClass="checkingAccount clearable"
                                                                 errorClass="error--text"
                                                                 maxLength="20"
                                                                 inputType="text"/>
                                            <c:E2EComponentInput pageMap="{! pagesContentMap['PAYMENT DETAILS'].fields }"
                                                                 field="CORR BANK ACCOUNT"
                                                                 firstClass="block__inputs validations"
                                                                 secondClass="input__obl"
                                                                 inputClass="corAccount clearable"
                                                                 errorClass="error--text"
                                                                 maxLength="20"
                                                                 inputType="text"/>
                                            <c:E2EComponentInputTooltip pageMap="{! pagesContentMap['PAYMENT DETAILS'].fields }"
                                                                        field="PREPAYMENT AMOUNT"
                                                                        firstClass="block__inputs validations"
                                                                        secondClass="input__obl"
                                                                        inputClass="prepayment clearable"
                                                                        errorClass="error--text"
                                                                        maxLength="7"
                                                                        inputType="text"
                                                                        position="top"/>
                                            <c:E2EComponentOutput pageMap="{! pagesContentMap['PAYMENT DETAILS'].fields }"
                                                                  field="MATCHING PAYMENT DETAILS"
                                                                  className="block__dops-title match-payment-details" />

                                            <apex:outputPanel layout="block" styleClass="{! IF(formParams.sendToInbound == false, '', 'pay-overdraft-lock') }">
                                                <c:E2EComponentCustomLink valueName="{! pagesContentMap['PAYMENT DETAILS'].fields['PRINT BLOCK'].elementItemsMap['LABEL'].value }"
                                                                          className="block__inputs-podr views"
                                                                          onclick="try{ga('send', 'event', 'checkbox', 'click', 'contract'); yaCounter1965880.reachGoal('checkbox_contract');} catch(e){}; validatePaymentDetailsToShowAgreement(); return false;"
                                                                          hrefLink=""/>
                                            </apex:outputPanel>

                                            <div class="modal fade" id="myModal2" role="dialog" >
                                                <div class="modal-dialog">
                                                    <div class="modal-content ">
                                                        <div class="modal-header">
                                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                                            <div class="modal-title">
                                                                {! pagesContentMap['PAYMENT DETAILS'].fields['FREE EXPRESS DELIVERY'].elementItemsMap['TITLE'].value }
                                                            </div>
                                                        </div>
                                                        <div class="modal-body modal-delivery-bonus">
                                                            <apex:outputPanel layout="block" styleClass="b-modal-text">
                                                                <apex:outputText escape="false" value="{! pagesContentMap['PAYMENT DETAILS'].fields['FREE EXPRESS DELIVERY'].elementItemsMap['BODY'].value }"/>
                                                            </apex:outputPanel>
                                                        </div>
                                                        <div class="modal-footer">
                                                            <div class="modal-buttons-block">
                                                                <div class="modal-button preview-outside-button">
                                                                    <apex:commandButton value="{! pagesContentMap['PAYMENT DETAILS'].fields['FREE EXPRESS DELIVERY'].elementItemsMap['BUTTON'].value }"
                                                                                        action="{! goToCongratulations }"
                                                                                        styleClass="modal-button preview-inside-button modal-button-continue"
                                                                                        reRender="congratulations, ordering__steps, showWarningGoToCongratulation, errorProcessing, step1, step2, step3, legalAndPaymentDetails, cards_header"
                                                                                        onComplete="setEvents_Congratulations(); setActiveStep('{!activeStep}'); setCookie('apex__url', '', 7);"
                                                                                        status="splashStatus"/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </apex:outputPanel>
                                        <apex:outputPanel layout="block" styleClass="stetps__blocks-footer">
                                            <c:E2EComponentButton value="{! pagesContentMap['SHARED RESOURCES'].fields['BUTTONS'].elementItemsMap['PREVIOUS STEP'].value }"
                                                                  onclick="clearTimeout(surveyTimeOut); return goBacktoLegalDetails();"
                                                                  firstClass="component-button"
                                                                  className="st__bl-btn prev"
                                                                  buttonClass="st__bl-btn prev-button" />
                                            <apex:actionFunction id="backToLegalDetails"
                                                                 name="backToLegalDetails"
                                                                 action="{!backToLegalDetails}"
                                                                 onComplete="setEvents_legalDetails(); setActiveStep('{!activeStep}');"
                                                                 reRender="ordering__steps, backToLegalDetails" />
                                            <c:E2EComponentButton value="{! pagesContentMap['SHARED RESOURCES'].fields['BUTTONS'].elementItemsMap['ORDER CARDS'].value }"
                                                                  onclick="clearTimeout(surveyTimeOut); return validatePaymentDetails();"
                                                                  firstClass="component-button"
                                                                  className="st__bl-btn next go-next-step open-modal-btn"
                                                                  buttonClass="st__bl-btn order-button"
                                                                  status="splashStatus"/>
                                        </apex:outputPanel>
                                        <apex:inputHidden id="bankInformationShortName" value="{!formParams.bankNameShort}" />
                                        <apex:inputHidden id="bankInformationOKPO" value="{!formParams.bankOkpo}" />
                                        <apex:inputHidden id="bankInformationTown" value="{!formParams.bankTown}" />
                                        <apex:inputHidden id="bankInformationAddress" value="{!formParams.bankAddress}" />
                                        <apex:inputHidden id="bankInformationInvalid" value="{!formParams.isBankInformationInvalid}" />
                                    </apex:outputPanel>
                                </apex:outputPanel>
                            </apex:outputPanel>
                        </div>

                        <!-- STEP 5 CONGRATULATIONS -->
                        <apex:outputPanel layout="block" id="congratulations" styleClass="step-congratulations stetps__blocks {! IF(activeStep == 'ContactDetails' , 'steps-lock','')}">
                            <apex:outputPanel layout="block" styleClass="headers__stepts {! IF(activeStep == 'Congratulations' , 'header-is-active','')}">
                                <span>{! pagesContentMap['SHARED RESOURCES'].fields['HEADERS'].elementItemsMap['CONGRATULATIONS HEADER'].value }</span>
                            </apex:outputPanel>

                            <apex:outputPanel rendered="{!IF(activeStep == 'Congratulations', TRUE, FALSE)}" layout="block" styleClass="stetps__blocks_container">

                                <apex:outputPanel layout="block" styleClass="stetps__blocks-content">
                                    <apex:outputPanel layout="block" styleClass="blocks__order">
                                        <c:E2EComponentOutputText pageMap="{! pagesContentMap['CONGRATULATIONS'].fields }"
                                                                  field="ORDER NUMBER BLOCK"
                                                                  textClass="name__order"
                                                                  outputText="ORDER NUMBER"
                                                                  valueText="VALUE"
                                                                  valueTextStyle="text-display-inline"/>
                                        <c:E2EComponentImage url="{!if(formParams.product == 'PetrolPlus_Rover' || formParams.product == 'Partner_Rover', URLFOR($Resource.e2eRu_images,'card.jpg'), URLFOR($Resource.e2eRu_images,'card_gas.png'))}"/>
                                    </apex:outputPanel>
                                </apex:outputPanel>

                                <apex:outputPanel layout="block" styleClass="stetps__blocks-footer stetps__blocks-footer-order">
                                    <c:E2EComponentOutputText pageMap="{! pagesContentMap['CONGRATULATIONS'].fields }"
                                                              field="ADDITIONAL INFO"
                                                              textClass="contract-congratulations"
                                                              outputText="LABEL"/>
                                    <c:E2EComponentOutputText pageMap="{! pagesContentMap['CONGRATULATIONS'].fields }"
                                                              field="AGREEMENT INFO"
                                                              textClass="contract-congratulations contract-congratulations-last"
                                                              outputText="LABEL"/>
                                    <!--<apex:outputPanel layout="block" styleClass="block__inputs-podr print">
                                        <c:E2EComponentCustomLink valueName="{! pagesContentMap['CONGRATULATIONS'].fields['PRINT BLOCK'].elementItemsMap['LABEL'].value }"
                                                                  className="print-document"
                                                                  onclick="openAgreementPDF(); return false;"
                                                                  hrefLink=""/>
                                    </apex:outputPanel>-->
                                    <!--<apex:outputPanel layout="block" styleClass="lk">
                                        <c:E2EComponentOutputText pageMap="{! pagesContentMap['CONGRATULATIONS'].fields }"
                                                                  field="LINK BLOCK"
                                                                  textClass="link-text"
                                                                  outputText="LABEL"/>
                                        <c:E2EComponentCustomLink valueName="{! pagesContentMap['CONGRATULATIONS'].fields['LINK BLOCK'].elementItemsMap['LINK NAME'].value }"
                                                                  className="link-content"
                                                                  onclick=""
                                                                  hrefLink="{! pagesContentMap['CONGRATULATIONS'].fields['LINK BLOCK'].elementItemsMap['URL'].value }"/>
                                    </apex:outputPanel>-->
                                    <c:E2EComponentButton value="{! pagesContentMap['CONGRATULATIONS'].fields['BACK TO SITE'].elementItemsMap['LABEL'].value }"
                                                          onclick="clearTimeout(surveyTimeOut); redirectToPPR(); return false;"
                                                          firstClass="component-button"
                                                          className="st__bl-btn finish back-to-site"
                                                          buttonClass="st__bl-btn back-to-site"/>
                                    <script>
                                        function redirectToPPR(){
                                            window.location.replace("{! pagesContentMap['CONGRATULATIONS'].fields['BACK TO SITE'].elementItemsMap['URL'].value }");
                                        }
                                    </script>
                                </apex:outputPanel>
                            </apex:outputPanel>

                        </apex:outputPanel>

                    </apex:outputPanel>

                    <!--ERROR PROCESS-->
                    <apex:outputPanel layout="block" id="errorProcessing">
                        <apex:outputPanel layout="block"  styleClass="b-error"
                                          rendered="{! OR(
                                              errorStep = 'RefuseToCooperate',
                                              errorStep = 'Inbound',
                                              errorStep = 'IsAClient',
                                              errorStep = 'SystemError')
                                              }">

                            <apex:actionFunction id="eraseCookieUrl"
                                                 name="eraseCookieUrl"
                                                 onComplete="setCookie('apex__url', '', 7);"/>
                            <script>
                                eraseCookieUrl();
                            </script>

                            <apex:outputPanel layout="block" styleClass="error-header">
                                {!  IF(errorStep = 'RefuseToCooperate', pagesContentMap['SYSTEM ERROR'].fields['REFUSE TO COOPERATE'].elementItemsMap['HEADER'].value,
                                IF(errorStep = 'Inbound', pagesContentMap['SYSTEM ERROR'].fields['INBOUND'].elementItemsMap['HEADER'].value,
                                IF(errorStep = 'IsAClient', pagesContentMap['SYSTEM ERROR'].fields['IS A CLIENT'].elementItemsMap['HEADER'].value,
                                IF(errorStep = 'SystemError', pagesContentMap['SYSTEM ERROR'].fields['SYSTEM ERROR'].elementItemsMap['HEADER'].value,'')))) }
                            </apex:outputPanel>
                            <apex:outputPanel layout="block" styleClass="error-text">
                                <apex:outputPanel layout="block" styleClass="error-content">
                                    {!  IF(errorStep = 'RefuseToCooperate', pagesContentMap['SYSTEM ERROR'].fields['REFUSE TO COOPERATE'].elementItemsMap['BODY'].value,
                                    IF(errorStep = 'Inbound', pagesContentMap['SYSTEM ERROR'].fields['INBOUND'].elementItemsMap['BODY'].value,
                                    IF(errorStep = 'IsAClient', pagesContentMap['SYSTEM ERROR'].fields['IS A CLIENT'].elementItemsMap['BODY'].value,
                                    IF(errorStep = 'SystemError', pagesContentMap['SYSTEM ERROR'].fields['SYSTEM ERROR'].elementItemsMap['BODY'].value,'')))) }
                                </apex:outputPanel>
                            </apex:outputPanel>
                            <apex:outputPanel layout="block" styleClass="error-footer">

                            </apex:outputPanel>
                        </apex:outputPanel>
                    </apex:outputPanel>

                </div>

            </div>

            <script  type="text/javascript">

            function sparkRequest(sOpportunityId, sFormDataId, deduplicationStatus) {
                if(deduplicationStatus == 'E2EProcess' || deduplicationStatus == 'E2EWithOutUpdate'){
                    var opportunityId = sOpportunityId;
                    var formDataId = sFormDataId;
                    var companyInnBlock = $j('.companyInn');
                    var companyInn = '';
                    companyInn = companyInnBlock.val();
                    if(companyInn.length == 10) {
                        isSole = false;
                        startPayOverdraftSplash();
                        $j('[id$=isSoleProprietor]').val(false);
                        getCompanyDataFromSpark(companyInn, isSole, opportunityId, formDataId);
                    } else if(companyInn.length == 12){
                        isSole = true;
                        $j('[id$=isSoleProprietor]').val(true);
                        getEntrepreneurShortReportByInn(companyInn, isSole, opportunityId, formDataId);
                    }
                }
            }

            function getCompanyDataFromSpark(companyInn, isSole, opportunityId, formDataId){
                Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.E2EFormRuCtrl.remoteGetCompanySparkInfoByInn}',
                    companyInn,
                    function(result, event){
                        if (event.status) {
                            $j('[id$=companyInfoSpark]').val(JSON.stringify(result));
                            /*console.log('getCompanyDataFromSpark result: ' + result);*/
                            remoteUpdateCompanySparkInfo(JSON.stringify(result), formDataId, opportunityId, companyInn);
                            remoteCreateEmployee(formDataId, JSON.stringify(result.extendedReport.leaderList));
                            checkCompany(isSole, opportunityId, formDataId);
                        } else if (event.type === 'exception') {
                            $j('[id$=sendToInbound]').val(true);
                            console.debug(event.message + "<br/>\n<pre>" + event.where + "</pre>");
                        } else {
                            console.debug(event.message);
                        }
                    }
                );
            }

            function remoteUpdateCompanySparkInfo(companySparkInfo, formDataId, opportunityId, companyInn) {
                Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.E2EFormRuCtrl.remoteUpdateCompanySparkInfo}',
                    companySparkInfo, formDataId, opportunityId, companyInn,
                    function(result, event){
                        if (event.status) {
                        } else if (event.type === 'exception') {
                            $j('[id$=sendToInbound]').val(true);
                            stopPayOverdraftSplash();
                            console.debug(event.message + "<br/>\n<pre>" + event.where + "</pre>");
                        } else {
                            console.debug(event.message);
                            stopPayOverdraftSplash();
                        }
                    }
                );
            }

            function remoteCreateEmployee(formDataId, leaderList) {
                Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.E2EFormRuCtrl.remoteCreateExecutiveEmployee}',
                    formDataId, leaderList,
                    function(result, event){
                        if (event.status) {
                            $j('[id$=executiveId]').val(result);
                        } else if (event.type === 'exception') {
                            console.debug(event.message + "<br/>\n<pre>" + event.where + "</pre>");
                        } else {
                            console.debug(event.message);
                        }
                    }
                );
            }

            function getEntrepreneurShortReportByInn(companyInn, isSole, opportunityId, formDataId){
                Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.E2EFormRuCtrl.remoteGetEntrepreneurShortReportByInn}',
                    companyInn,
                    function(result, event){
                        if (event.status) {
                            $j('[id$=soleInfoSpark]').val(JSON.stringify(result));
                            /*console.log('getEntrepreneurShortReportByInn result: ' + result);*/
                            updateEntrepreneurShortReportData(JSON.stringify(result), formDataId);
                            checkCompany(isSole, opportunityId, formDataId);
                        } else if (event.type === 'exception') {
                            $j('[id$=sendToInbound]').val(true);
                            stopPayOverdraftSplash();
                            console.debug(event.message + "<br/>\n<pre>" + event.where + "</pre>");
                        } else {
                            console.debug(event.message);
                            stopPayOverdraftSplash();
                        }
                    }
                );
            }

            function updateEntrepreneurShortReportData(soleInfoSpark, formDataId) {
                Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.E2EFormRuCtrl.remoteUpdateEntrepreneurShortReport}',
                    soleInfoSpark, formDataId,
                    function(result, event){
                        if (event.status) {
                        } else if (event.type === 'exception') {
                            $j('[id$=sendToInbound]').val(true);
                            stopPayOverdraftSplash();
                            console.debug(event.message + "<br/>\n<pre>" + event.where + "</pre>");
                        } else {
                            console.debug(event.message);
                            stopPayOverdraftSplash();
                        }
                    }
                );
            }

            function checkCompany(isSole, opportunityId, formDataId){
                var isManualEntry = $j('.companyNotExist').is(":checked") == true;
                if(!isManualEntry){
                    var companyInfo = '';
                    if(isSole == true) {
                        companyInfo = $j('[id$=soleInfoSpark]').val();
                    } else {
                        companyInfo = $j('[id$=companyInfoSpark]').val();
                    }
                    if(companyInfo != ''){
                        var company = JSON.parse(companyInfo);
                        var companyInn = isSole === 'true' ? company.inn : company.inn;
                        var companySparkId =  isSole === 'true' ? company.sparkID : company.sparkID;
                        Visualforce.remoting.Manager.invokeAction(
                        '{!$RemoteAction.E2EFormRuCtrl.checkCompany}',
                        isSole, companyInn, companySparkId, opportunityId,
                            function(verification, event){
                                if (event.status) {
                                    if(verification != null){

                                        // TODO updateVerifiedDecision

                                        Visualforce.remoting.Manager.invokeAction(
                                        '{!$RemoteAction.E2EFormRuCtrl.updateVerifiedDecision}',
                                        formDataId, opportunityId, companyInn, JSON.stringify(verification),
                                            function(result, event){
                                                if (event.status) {

                                                } else if (event.type === 'exception') {
                                                    $j('[id$=sendToInbound]').val(true);
                                                    console.debug(event.message + "<br/>\n<pre>" + event.where + "</pre>");
                                                } else {
                                                    console.debug(event.message);
                                                }
                                            }
                                        );
                                        $j('[id$=blackListDecision]').val(verification.decision);
                                        if (verification.decision == 3) {
                                            $j('[id$=opportunityLostReason]').val('Другое');
                                            stopPayOverdraftSplash();
                                        } else if (verification.decision == 1 || verification.decision == 4) {
                                            $j('[id$=sendToInbound]').val(true);
                                            stopPayOverdraftSplash();
                                        }
                                        $j('[id$=checkedInBlackList]').val(' > CheckedInBlackList');
                                        if (isSole == false && verification.decision != 3) {
                                            getScoreDecision(isManualEntry, companyInn, companySparkId,
                                            opportunityId, JSON.stringify(verification), formDataId);
                                        }
                                    } else {
                                        $j('[id$=sendToInbound]').val(true);
                                        stopPayOverdraftSplash();
                                    }
                                } else if (event.type === 'exception') {
                                    $j('[id$=sendToInbound]').val(true);
                                    console.debug(event.message + "<br/>\n<pre>" + event.where + "</pre>");
                                    stopPayOverdraftSplash();
                                } else {
                                    console.debug(event.message);
                                    stopPayOverdraftSplash();
                                }
                            }
                        );
                    } else {
                        $j('[id$=sendToInbound]').val(true);
                    }
                }
            }

            function getScoreDecision(isManualEntry, inn, sparkId, opportunityId, verificationDecision, formDataId){
                Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.E2EFormRuCtrl.getScore}',
                    isManualEntry, inn, sparkId, opportunityId, verificationDecision,
                    function(decision, event){
                        if (event.status) {
                            if(decision != null){
                                $j('[id$=scoringPassed]').val(' > ScoringPassed');
                                $j('[id$=scoringDecisionCode]').val(decision.decision);

                                if (decision.decision == 0) {
                                    allowPayOverdraft = true;
                                }
                                updateScoreDecision(formDataId, opportunityId, JSON.stringify(decision));
                                stopPayOverdraftSplash();
                            } else {
                                stopPayOverdraftSplash();
                                $j('[id$=scoringDecision]').val('Предоплата');
                            }
                        } else if (event.type === 'exception') {
                            console.debug("exception");
                            $j('[id$=sendToInbound]').val(true);
                            console.debug(event.message + "<br/>\n<pre>" + event.where + "</pre>");
                            stopPayOverdraftSplash();
                        } else {
                            console.debug(event.message);
                            stopPayOverdraftSplash();
                        }
                    }
                );
            }

            function updateScoreDecision(formDataId, opportunityId, verificationDecision) {
                console.debug("execute updateScoreDecision");
                Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.E2EFormRuCtrl.updateScoreDecision}',
                    formDataId, opportunityId, verificationDecision,
                    function(decision, event){
                        if (event.status) {
                            console.debug("updateScoreDecision: OK");
                        } else if (event.type === 'exception') {
                            $j('[id$=sendToInbound]').val(true);
                            console.debug(event.message + "<br/>\n<pre>" + event.where + "</pre>");
                        } else {
                            console.debug(event.message);
                        }
                    }
                );
            }

            $(document).mouseleave(function(e){
                if (e.clientY < 10) {
                    $(".exitblock").fadeIn();
                }
            });

            $(document).click(function(e) {
                if (($(".exitblock").is(':visible')) && (!$(e.target).closest(".exitblock .modaltext").length)) {
                    $(".exitblock").remove();
                }
            });

        </script>

            <div id="footer" >
                <div class="default">
                    <div>{!$Label.E2eClassicFooter}</div>
                    <div id="stockInfo">
                        *Акция действует только для новых клиентов ООО «ППР» при оформлении договора онлайн через данную форму на сайте.
                        При обращении к менеджерам для оффлайн консультации данная акция не действительна.
                    </div>

                    <div style="padding-top:10px;">Вся представленная информация на данном сайте носит информационный характер, и ни при каких условиях не является публичной или иной офертой,
                        определяемой положениями Гражданского кодекса РФ.</div>
                </div>
            </div>

            <apex:outputPanel rendered="{! pagesContentMap['CONTACT DETAILS'].fields['SURVEY SETTING'].elementItemsMap['enableSurvey'].value }">
                <div class="exitblock" >
                    <div class="fon"></div>
                    <div class="modaltext">
                        <br>{! pagesContentMap['CONTACT DETAILS'].fields['SURVEY LABEL'].elementItemsMap['Label'].value }</br>
                        <br><a href="{! pagesContentMap['CONTACT DETAILS'].fields['SURVEY URL'].elementItemsMap['URL'].value }" style="color: white" class="btn" target="_blank">{!$Label.E2EClassicSurveyStart}</a></br>
                    </div>
                    <div class="closeblock">+</div>
                </div>
            </apex:outputPanel>


        </apex:form>
    </div>
    </body>
    <!--<footer class="ppr-footer">-->
    <!--</footer>-->
    <apex:outputPanel layout="block">
    </apex:outputPanel>
</apex:page>